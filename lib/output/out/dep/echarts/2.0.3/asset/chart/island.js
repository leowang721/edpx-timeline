/*! @2014 Leo Wang. All Rights Reserved */
define("echarts/chart/island",["require","../component/base","./base","zrender/shape/Circle","../config","../util/ecData","zrender/tool/util","zrender/tool/event","zrender/tool/color","../util/accMath","../chart"],function(require){function e(e,s,r,a,h){t.call(this,e,s,r,{},h),i.call(this),this._nameConnector,this._valueConnector,this._zrHeight=this.zr.getHeight(),this._zrWidth=this.zr.getWidth();var l=this;l.shapeHandler.onmousewheel=function(e){var t=e.target,i=e.event,s=n.getDelta(i);s=s>0?-1:1,t.style.r-=s,t.style.r=t.style.r<5?5:t.style.r;var r=o.get(t,"value"),a=r*l.option.island.calculateStep;if(a>1)r=Math.round(r-a*s);else r=(r-a*s).toFixed(2)-0;var h=o.get(t,"name");t.style.text=h+":"+r,o.set(t,"value",r),o.set(t,"name",h),l.zr.modShape(t.id),l.zr.refresh(),n.stop(i)}}var t=require("../component/base"),i=require("./base"),s=require("zrender/shape/Circle"),r=require("../config"),o=require("../util/ecData"),a=require("zrender/tool/util"),n=require("zrender/tool/event");return e.prototype={type:r.CHART_TYPE_ISLAND,_combine:function(e,t){var i=require("zrender/tool/color"),s=require("../util/accMath"),r=s.accAdd(o.get(e,"value"),o.get(t,"value")),a=o.get(e,"name")+this._nameConnector+o.get(t,"name");e.style.text=a+this._valueConnector+r,o.set(e,"value",r),o.set(e,"name",a),e.style.r=this.option.island.r,e.style.color=i.mix(e.style.color,t.style.color)},refresh:function(e){if(e)e.island=this.reformOption(e.island),this.option=e,this._nameConnector=this.option.nameConnector,this._valueConnector=this.option.valueConnector},getOption:function(){return this.option},resize:function(){var e=this.zr.getWidth(),t=this.zr.getHeight(),i=e/(this._zrWidth||e),s=t/(this._zrHeight||t);if(1!=i||1!=s){this._zrWidth=e,this._zrHeight=t;for(var r=0,o=this.shapeList.length;o>r;r++)this.zr.modShape(this.shapeList[r].id,{style:{x:Math.round(this.shapeList[r].style.x*i),y:Math.round(this.shapeList[r].style.y*s)}})}},add:function(e){var t=o.get(e,"name"),i=o.get(e,"value"),r="undefined"!=typeof o.get(e,"series")?o.get(e,"series").name:"",a=this.getFont(this.option.island.textStyle),n={zlevel:this._zlevelBase,style:{x:e.style.x,y:e.style.y,r:this.option.island.r,color:e.style.color||e.style.strokeColor,text:t+this._valueConnector+i,textFont:a},draggable:!0,hoverable:!0,onmousewheel:this.shapeHandler.onmousewheel,_type:"island"};if("#fff"==n.style.color)n.style.color=e.style.strokeColor;this.setCalculable(n),n.dragEnableTime=0,o.pack(n,{name:r},-1,i,-1,t),n=new s(n),this.shapeList.push(n),this.zr.addShape(n)},del:function(e){this.zr.delShape(e.id);for(var t=[],i=0,s=this.shapeList.length;s>i;i++)if(this.shapeList[i].id!=e.id)t.push(this.shapeList[i]);this.shapeList=t},ondrop:function(e,t){if(this.isDrop&&e.target){var i=e.target,s=e.dragged;this._combine(i,s),this.zr.modShape(i.id),t.dragIn=!0,this.isDrop=!1}},ondragend:function(e,t){var i=e.target;if(!this.isDragend){if(!t.dragIn)i.style.x=n.getX(e.event),i.style.y=n.getY(e.event),this.add(i),t.needRefresh=!0}else if(t.dragIn)this.del(i),t.needRefresh=!0;this.isDragend=!1}},a.inherits(e,i),a.inherits(e,t),require("../chart").define("island",e),e});