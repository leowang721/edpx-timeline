/*! @2014 Leo Wang. All Rights Reserved */
define("echarts/chart/radar",["require","../component/base","./base","zrender/shape/Polygon","../component/polar","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../util/accMath","../chart"],function(require){function e(e,s,a,r,o){t.call(this,e,s,a,r,o),i.call(this),this.refresh(r)}var t=require("../component/base"),i=require("./base"),s=require("zrender/shape/Polygon");require("../component/polar");var a=require("../config"),r=require("../util/ecData"),o=require("zrender/tool/util"),n=require("zrender/tool/color");return e.prototype={type:a.CHART_TYPE_RADAR,_buildShape:function(){this.selectedMap={},this._symbol=this.option.symbolList,this._queryTarget,this._dropBoxList=[],this._radarDataCounter=0;for(var e,t=this.series,i=this.component.legend,s=0,r=t.length;r>s;s++)if(t[s].type==a.CHART_TYPE_RADAR)if(this.serie=this.reformOption(t[s]),e=this.serie.name||"",this.selectedMap[e]=i?i.isSelected(e):!0,this.selectedMap[e]){if(this._queryTarget=[this.serie,this.option],this.deepQuery(this._queryTarget,"calculable"))this._addDropBox(s);this._buildSingleRadar(s),this.buildMark(s)}this.addShapeList()},_buildSingleRadar:function(e){for(var t,i,s,a,r=this.component.legend,o=this.serie.data,n=this.deepQuery(this._queryTarget,"calculable"),h=0;h<o.length;h++)if(s=o[h].name||"",this.selectedMap[s]=r?r.isSelected(s):!0,this.selectedMap[s]){if(r){if(i=r.getColor(s),t=r.getItemShape(s))t.style.brushType=this.deepQuery([o[h],this.serie],"itemStyle.normal.areaStyle")?"both":"stroke",r.setItemShape(s,t)}else i=this.zr.getColor(h);a=this._getPointList(this.serie.polarIndex,o[h]),this._addSymbol(a,i,h,e,this.serie.polarIndex),this._addDataShape(a,i,o[h],e,h,n),this._radarDataCounter++}else;},_getPointList:function(e,t){for(var i,s=[],a=this.component.polar,r=0,o=t.value.length;o>r;r++)if(i=a.getVector(e,r,"undefined"!=typeof t.value[r].value?t.value[r].value:t.value[r]))s.push(i);return s},_addSymbol:function(e,t,i,s,a){for(var o,n=this.series,h=this.component.polar,l=0,p=e.length;p>l;l++)o=this.getSymbolShape(this.deepMerge([n[s].data[i],n[s]]),s,n[s].data[i].value[l],l,h.getIndicatorText(a,l),e[l][0],e[l][1],this._symbol[this._radarDataCounter%this._symbol.length],t,"#fff","vertical"),o.zlevel=this._zlevelBase+1,r.set(o,"data",n[s].data[i]),r.set(o,"value",n[s].data[i].value),r.set(o,"dataIndex",i),r.set(o,"special",l),this.shapeList.push(o)},_addDataShape:function(e,t,i,a,o,h){var l=this.series,p=[i,this.serie],d=this.getItemStyleColor(this.deepQuery(p,"itemStyle.normal.color"),a,o,i),c=this.deepQuery(p,"itemStyle.normal.lineStyle.width"),f=this.deepQuery(p,"itemStyle.normal.lineStyle.type"),u=this.deepQuery(p,"itemStyle.normal.areaStyle.color"),y=this.deepQuery(p,"itemStyle.normal.areaStyle"),m={zlevel:this._zlevelBase,style:{pointList:e,brushType:y?"both":"stroke",color:u||d||n.alpha(t,.5),strokeColor:d||t,lineWidth:c,lineType:f},highlightStyle:{brushType:this.deepQuery(p,"itemStyle.emphasis.areaStyle")||y?"both":"stroke",color:this.deepQuery(p,"itemStyle.emphasis.areaStyle.color")||u||d||n.alpha(t,.5),strokeColor:this.getItemStyleColor(this.deepQuery(p,"itemStyle.emphasis.color"),a,o,i)||d||t,lineWidth:this.deepQuery(p,"itemStyle.emphasis.lineStyle.width")||c,lineType:this.deepQuery(p,"itemStyle.emphasis.lineStyle.type")||f}};if(r.pack(m,l[a],a,i,o,i.name,this.component.polar.getIndicator(l[a].polarIndex)),h)m.draggable=!0,this.setCalculable(m);m=new s(m),this.shapeList.push(m)},_addDropBox:function(e){var t=this.series,i=this.deepQuery(this._queryTarget,"polarIndex");if(!this._dropBoxList[i]){var s=this.component.polar.getDropBox(i);s.zlevel=this._zlevelBase,this.setCalculable(s),r.pack(s,t,e,void 0,-1),this.shapeList.push(s),this._dropBoxList[i]=!0}},ondragend:function(e,t){var i=this.series;if(this.isDragend&&e.target){var s=e.target,a=r.get(s,"seriesIndex"),o=r.get(s,"dataIndex");this.component.legend&&this.component.legend.del(i[a].data[o].name),i[a].data.splice(o,1),t.dragOut=!0,t.needRefresh=!0,this.isDragend=!1}},ondrop:function(e,t){var i=this.series;if(this.isDrop&&e.target){var s,a,o=e.target,n=e.dragged,h=r.get(o,"seriesIndex"),l=r.get(o,"dataIndex"),p=this.component.legend;if(-1==l)s={value:r.get(n,"value"),name:r.get(n,"name")},i[h].data.push(s),p&&p.add(s.name,n.style.color||n.style.strokeColor);else{var d=require("../util/accMath");s=i[h].data[l],p&&p.del(s.name),s.name+=this.option.nameConnector+r.get(n,"name"),a=r.get(n,"value");for(var c=0;c<a.length;c++)s.value[c]=d.accAdd(s.value[c],a[c]);p&&p.add(s.name,n.style.color||n.style.strokeColor)}t.dragIn=t.dragIn||!0,this.isDrop=!1}},refresh:function(e){if(e)this.option=e,this.series=e.series;this.backupShapeList(),this._buildShape()}},o.inherits(e,i),o.inherits(e,t),require("../chart").define("radar",e),e});