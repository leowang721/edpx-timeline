/*! @2014 Leo Wang. All Rights Reserved */
define("echarts/util/ecEffect",["require","../util/ecData","zrender/shape/Circle","zrender/shape/Image","../util/shape/Icon","../util/shape/Symbol","zrender/tool/env"],function(require){function e(e,t,i,o){var r=i.effect,l=r.color||i.style.strokeColor||i.style.color,d=r.shadowColor||l,p=r.scaleSize,c="undefined"!=typeof r.shadowBlur?r.shadowBlur:p,f=new n({zlevel:o,style:{brushType:"stroke",iconType:"pin"!=i.style.iconType&&"droplet"!=i.style.iconType?i.style.iconType:"circle",x:c+1,y:c+1,n:i.style.n,width:i.style.width*p,height:i.style.height*p,lineWidth:1,strokeColor:l,shadowColor:d,shadowBlur:c},draggable:!1,hoverable:!1});if(h)f.style.image=e.shapeToImage(f,f.style.width+2*c+2,f.style.height+2*c+2).style.image,f=new a({zlevel:f.zlevel,style:f.style,draggable:!1,hoverable:!1});s.clone(i,f),f.position=i.position,t.push(f),e.addShape(f);var u=window.devicePixelRatio||1,g=(f.style.width/u-i.style.width)/2;f.style.x=i.style._x-g,f.style.y=i.style._y-g;var _=100*(r.period+10*Math.random());e.modShape(i.id,{invisible:!0});var y=f.style.x+f.style.width/2/u,m=f.style.y+f.style.height/2/u;e.modShape(f.id,{scale:[.1,.1,y,m]}),e.animate(f.id,"",r.loop).when(_,{scale:[1,1,y,m]}).done(function(){i.effect.show=!1,e.delShape(f.id)}).start()}function t(e,t,i,s){var o=i.effect,a=o.color||i.style.strokeColor||i.style.color,n=o.scaleSize,h=o.shadowColor||a,l="undefined"!=typeof o.shadowBlur?o.shadowBlur:2*n,d=window.devicePixelRatio||1,p=new r({zlevel:s,position:i.position,scale:i.scale,style:{pointList:i.style.pointList,iconType:i.style.iconType,color:a,strokeColor:a,shadowColor:h,shadowBlur:l*d,random:!0,brushType:"fill",lineWidth:1,size:i.style.size},draggable:!1,hoverable:!1});t.push(p),e.addShape(p),e.modShape(i.id,{invisible:!0});for(var c=Math.round(100*o.period),f={},u={},g=0;20>g;g++)p.style["randomMap"+g]=0,f={},f["randomMap"+g]=100,u={},u["randomMap"+g]=0,p.style["randomMap"+g]=100*Math.random(),e.animate(p.id,"style",!0).when(c,f).when(2*c,u).when(3*c,f).when(4*c,f).delay(Math.random()*c*g).start()}function i(e,t,i,n){var r,l=i.effect,d=l.color||i.style.strokeColor||i.style.color,p=l.shadowColor||i.style.strokeColor||d,c=i.style.lineWidth*l.scaleSize,f="undefined"!=typeof l.shadowBlur?l.shadowBlur:c,u=new o({zlevel:n,style:{x:f,y:f,r:c,color:d,shadowColor:p,shadowBlur:f},draggable:!1,hoverable:!1});if(h)u.style.image=e.shapeToImage(u,2*(c+f),2*(c+f)).style.image,u=new a({zlevel:u.zlevel,style:u.style,draggable:!1,hoverable:!1}),r=f;else r=0;s.clone(i,u),u.position=i.position,t.push(u),e.addShape(u),u.style.x=i.style.xStart-r,u.style.y=i.style.yStart-r;var g=(i.style.xStart-i.style.xEnd)*(i.style.xStart-i.style.xEnd)+(i.style.yStart-i.style.yEnd)*(i.style.yStart-i.style.yEnd),_=Math.round(Math.sqrt(Math.round(g*l.period*l.period)));if(!i.style.smooth)e.animate(u.id,"style",l.loop).when(_,{x:i._x-r,y:i._y-r}).done(function(){i.effect.show=!1,e.delShape(u.id)}).start();else{var y=i.style.pointList||i.getPointList(i.style),m=y.length;_=Math.round(_/m);for(var x=e.animate(u.id,"style",l.loop),v=Math.ceil(m/8),b=0;m-v>b;b+=v)x.when(_*(b+1),{x:y[b][0]-r,y:y[b][1]-r});x.when(_*m,{x:y[m-1][0]-r,y:y[m-1][1]-r}),x.done(function(){i.effect.show=!1,e.delShape(u.id)}),x.start("spline")}}var s=require("../util/ecData"),o=require("zrender/shape/Circle"),a=require("zrender/shape/Image"),n=require("../util/shape/Icon"),r=require("../util/shape/Symbol"),h=require("zrender/tool/env").canvasSupported;return{point:e,largePoint:t,line:i}});