/*! @2014 Leo Wang. All Rights Reserved */
define("echarts/component/tooltip",["require","./base","../util/shape/Cross","zrender/shape/Line","zrender/shape/Rectangle","../config","../util/ecData","zrender/config","zrender/tool/event","zrender/tool/area","zrender/tool/color","zrender/tool/util","zrender/shape/Base","../component"],function(require){function e(e,o,a,n,h){t.call(this,e,o,a,n,h),this.dom=h.dom;var l=this;l._onmousemove=function(e){return l.__onmousemove(e)},l._onglobalout=function(e){return l.__onglobalout(e)},this.zr.on(r.EVENT.MOUSEMOVE,l._onmousemove),this.zr.on(r.EVENT.GLOBALOUT,l._onglobalout),l._hide=function(e){return l.__hide(e)},l._tryShow=function(e){return l.__tryShow(e)},l._refixed=function(e){return l.__refixed(e)},l._setContent=function(e,t){return l.__setContent(e,t)},this._tDom=this._tDom||document.createElement("div"),this._tDom.onselectstart=function(){return!1},this._tDom.style.position="absolute",this.hasAppend=!1,this._axisLineShape&&this.zr.delShape(this._axisLineShape.id),this._axisLineShape=new s({zlevel:this._zlevelBase,invisible:!0,hoverable:!1}),this.shapeList.push(this._axisLineShape),this.zr.addShape(this._axisLineShape),this._axisShadowShape&&this.zr.delShape(this._axisShadowShape.id),this._axisShadowShape=new s({zlevel:1,invisible:!0,hoverable:!1}),this.shapeList.push(this._axisShadowShape),this.zr.addShape(this._axisShadowShape),this._axisCrossShape&&this.zr.delShape(this._axisCrossShape.id),this._axisCrossShape=new i({zlevel:this._zlevelBase,invisible:!0,hoverable:!1}),this.shapeList.push(this._axisCrossShape),this.zr.addShape(this._axisCrossShape),this.showing=!1,this.refresh(n)}var t=require("./base"),i=require("../util/shape/Cross"),s=require("zrender/shape/Line"),o=require("zrender/shape/Rectangle"),a=new o({}),n=require("../config"),h=require("../util/ecData"),r=require("zrender/config"),l=require("zrender/tool/event"),p=require("zrender/tool/area"),d=require("zrender/tool/color"),c=require("zrender/tool/util"),f=require("zrender/shape/Base");return e.prototype={type:n.COMPONENT_TYPE_TOOLTIP,_gCssText:"position:absolute;display:block;border-style:solid;white-space:nowrap;",_style:function(e){if(!e)return"";var t=[];if(e.transitionDuration){var i="left "+e.transitionDuration+"s,top "+e.transitionDuration+"s";t.push("transition:"+i),t.push("-moz-transition:"+i),t.push("-webkit-transition:"+i),t.push("-o-transition:"+i)}if(e.backgroundColor)t.push("background-Color:"+d.toHex(e.backgroundColor)),t.push("filter:alpha(opacity=70)"),t.push("background-Color:"+e.backgroundColor);if("undefined"!=typeof e.borderWidth)t.push("border-width:"+e.borderWidth+"px");if("undefined"!=typeof e.borderColor)t.push("border-color:"+e.borderColor);if("undefined"!=typeof e.borderRadius)t.push("border-radius:"+e.borderRadius+"px"),t.push("-moz-border-radius:"+e.borderRadius+"px"),t.push("-webkit-border-radius:"+e.borderRadius+"px"),t.push("-o-border-radius:"+e.borderRadius+"px");var s=e.textStyle;if(s)s.color&&t.push("color:"+s.color),s.decoration&&t.push("text-decoration:"+s.decoration),s.align&&t.push("text-align:"+s.align),s.fontFamily&&t.push("font-family:"+s.fontFamily),s.fontSize&&t.push("font-size:"+s.fontSize+"px"),s.fontSize&&t.push("line-height:"+Math.round(3*s.fontSize/2)+"px"),s.fontStyle&&t.push("font-style:"+s.fontStyle),s.fontWeight&&t.push("font-weight:"+s.fontWeight);var o=e.padding;if("undefined"!=typeof o)o=this.reformCssArray(o),t.push("padding:"+o[0]+"px "+o[1]+"px "+o[2]+"px "+o[3]+"px");return t=t.join(";")+";"},__hide:function(){if(this._tDom)this._tDom.style.display="none";var e=!1;if(!this._axisLineShape.invisible)this._axisLineShape.invisible=!0,this.zr.modShape(this._axisLineShape.id),e=!0;if(!this._axisShadowShape.invisible)this._axisShadowShape.invisible=!0,this.zr.modShape(this._axisShadowShape.id),e=!0;if(!this._axisCrossShape.invisible)this._axisCrossShape.invisible=!0,this.zr.modShape(this._axisCrossShape.id),e=!0;if(this._lastTipShape&&this._lastTipShape.tipShape.length>0)this.zr.delShape(this._lastTipShape.tipShape),this._lastTipShape=!1,this.shapeList.length=2;e&&this.zr.refresh(),this.showing=!1},_show:function(e,t,i,s){var o=this._tDom.offsetHeight,a=this._tDom.offsetWidth;if(e){if("function"==typeof e)e=e([t,i]);if(e instanceof Array)t=e[0],i=e[1]}if(t+a>this._zrWidth)t-=a+40;if(i+o>this._zrHeight)i-=o-20;if(20>i)i=0;if(this._tDom.style.cssText=this._gCssText+this._defaultCssText+(s?s:"")+"left:"+t+"px;top:"+i+"px;",10>o||10>a)setTimeout(this._refixed,20);this.showing=!0},__refixed:function(){if(this._tDom){var e="",t=this._tDom.offsetHeight,i=this._tDom.offsetWidth;if(this._tDom.offsetLeft+i>this._zrWidth)e+="left:"+(this._zrWidth-i-20)+"px;";if(this._tDom.offsetTop+t>this._zrHeight)e+="top:"+(this._zrHeight-t-10)+"px;";if(""!==e)this._tDom.style.cssText+=e}},__tryShow:function(){var e,t;if(!this._curTarget)this._findPolarTrigger()||this._findAxisTrigger();else{if("island"==this._curTarget._type&&this.option.tooltip.show)return void this._showItemTrigger();var i=h.get(this._curTarget,"series"),s=h.get(this._curTarget,"data");if(e=this.deepQuery([s,i,this.option],"tooltip.show"),"undefined"==typeof i||"undefined"==typeof s||e===!1)clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),this._hidingTicket=setTimeout(this._hide,this._hideDelay);else t=this.deepQuery([s,i,this.option],"tooltip.trigger"),"axis"==t?this._showAxisTrigger(i.xAxisIndex,i.yAxisIndex,h.get(this._curTarget,"dataIndex")):this._showItemTrigger()}},_findAxisTrigger:function(){if(!this.component.xAxis||!this.component.yAxis)return void(this._hidingTicket=setTimeout(this._hide,this._hideDelay));for(var e,t,i=this.option.series,s=0,o=i.length;o>s;s++)if("axis"==this.deepQuery([i[s],this.option],"tooltip.trigger"))if(e=i[s].xAxisIndex||0,t=i[s].yAxisIndex||0,this.component.xAxis.getAxis(e)&&this.component.xAxis.getAxis(e).type==n.COMPONENT_TYPE_AXIS_CATEGORY)return void this._showAxisTrigger(e,t,this._getNearestDataIndex("x",this.component.xAxis.getAxis(e)));else if(this.component.yAxis.getAxis(t)&&this.component.yAxis.getAxis(t).type==n.COMPONENT_TYPE_AXIS_CATEGORY)return void this._showAxisTrigger(e,t,this._getNearestDataIndex("y",this.component.yAxis.getAxis(t)));else return void this._showAxisTrigger(e,t,-1);if("cross"==this.option.tooltip.axisPointer.type)this._showAxisTrigger(-1,-1,-1)},_findPolarTrigger:function(){if(!this.component.polar)return!1;var e,t=l.getX(this._event),i=l.getY(this._event),s=this.component.polar.getNearestIndex([t,i]);if(s)e=s.valueIndex,s=s.polarIndex;else s=-1;if(-1!=s)return this._showPolarTrigger(s,e);else return!1},_getNearestDataIndex:function(e,t){var i=-1,s=l.getX(this._event),o=l.getY(this._event);if("x"==e){for(var a,n,h=this.component.grid.getXend(),r=t.getCoordByIndex(i);h>r&&(n=r,s>=r);)a=r,r=t.getCoordByIndex(++i);if(0>=i)i=0;else if(n-s>=s-a)i-=1;else if("undefined"==typeof t.getNameByIndex(i))i-=1;return i}else{for(var p,d,c=this.component.grid.getY(),r=t.getCoordByIndex(i);r>c&&(p=r,r>=o);)d=r,r=t.getCoordByIndex(++i);if(0>=i)i=0;if(o-p>=d-o)i-=1;else if("undefined"==typeof t.getNameByIndex(i))i-=1;return i}},_showAxisTrigger:function(e,t,i){if(!this._event.connectTrigger&&this.messageCenter.dispatch(n.EVENT.TOOLTIP_IN_GRID,this._event,null,this.myChart),"undefined"==typeof this.component.xAxis||"undefined"==typeof this.component.yAxis||"undefined"==typeof e||"undefined"==typeof t)return clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),void(this._hidingTicket=setTimeout(this._hide,this._hideDelay));var s,o,a,h,r,p,d=this.option.series,c=[],f=[],u="";if("axis"==this.option.tooltip.trigger){if(this.option.tooltip.show===!1)return;h=this.option.tooltip.formatter,r=this.option.tooltip.position}if(-1!=e&&this.component.xAxis.getAxis(e).type==n.COMPONENT_TYPE_AXIS_CATEGORY){s=this.component.xAxis.getAxis(e);for(var g=0,y=d.length;y>g;g++)if(this._isSelected(d[g].name)){if(d[g].xAxisIndex==e&&"axis"==this.deepQuery([d[g],this.option],"tooltip.trigger"))p=this.query(d[g],"tooltip.showContent")||p,h=this.query(d[g],"tooltip.formatter")||h,r=this.query(d[g],"tooltip.position")||r,u+=this._style(this.query(d[g],"tooltip")),c.push(d[g]),f.push(g)}else;this.messageCenter.dispatch(n.EVENT.TOOLTIP_HOVER,this._event,{seriesIndex:f,dataIndex:i},this.myChart),a=l.getY(this._event),o=this.subPixelOptimize(s.getCoordByIndex(i),this._axisLineWidth),this._styleAxisPointer(c,o,this.component.grid.getY(),o,this.component.grid.getYend(),s.getGap(),o,a)}else if(-1!=t&&this.component.yAxis.getAxis(t).type==n.COMPONENT_TYPE_AXIS_CATEGORY){s=this.component.yAxis.getAxis(t);for(var g=0,y=d.length;y>g;g++)if(this._isSelected(d[g].name)){if(d[g].yAxisIndex==t&&"axis"==this.deepQuery([d[g],this.option],"tooltip.trigger"))p=this.query(d[g],"tooltip.showContent")||p,h=this.query(d[g],"tooltip.formatter")||h,r=this.query(d[g],"tooltip.position")||r,u+=this._style(this.query(d[g],"tooltip")),c.push(d[g]),f.push(g)}else;this.messageCenter.dispatch(n.EVENT.TOOLTIP_HOVER,this._event,{seriesIndex:f,dataIndex:i},this.myChart),o=l.getX(this._event),a=this.subPixelOptimize(s.getCoordByIndex(i),this._axisLineWidth),this._styleAxisPointer(c,this.component.grid.getX(),a,this.component.grid.getXend(),a,s.getGap(),o,a)}else if(o=l.getX(this._event),a=l.getY(this._event),this._styleAxisPointer(d,this.component.grid.getX(),a,this.component.grid.getXend(),a,0,o,a),i>=0)this._showItemTrigger();else clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),this._tDom.style.display="none";if(c.length>0){var _;if("function"==typeof h){for(var m=[],g=0,y=c.length;y>g;g++)_=c[g].data[i],_="undefined"!=typeof _?"undefined"!=typeof _.value?_.value:_:"-",m.push([c[g].name||"",s.getNameByIndex(i),_]);this._curTicket="axis:"+i,this._tDom.innerHTML=h.call(this.myChart,m,this._curTicket,this._setContent)}else if("string"==typeof h){this._curTicket=0/0,h=h.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}");for(var g=0,y=c.length;y>g;g++)h=h.replace("{a"+g+"}",this._encodeHTML(c[g].name||"")),h=h.replace("{b"+g+"}",this._encodeHTML(s.getNameByIndex(i))),_=c[g].data[i],_="undefined"!=typeof _?"undefined"!=typeof _.value?_.value:_:"-",h=h.replace("{c"+g+"}",_ instanceof Array?_:this.numAddCommas(_));this._tDom.innerHTML=h}else{this._curTicket=0/0,h=this._encodeHTML(s.getNameByIndex(i));for(var g=0,y=c.length;y>g;g++)h+="<br/>"+this._encodeHTML(c[g].name||"")+" : ",_=c[g].data[i],_="undefined"!=typeof _?"undefined"!=typeof _.value?_.value:_:"-",h+=_ instanceof Array?_:this.numAddCommas(_);this._tDom.innerHTML=h}if(p===!1||!this.option.tooltip.showContent)return;if(!this.hasAppend)this._tDom.style.left=this._zrWidth/2+"px",this._tDom.style.top=this._zrHeight/2+"px",this.dom.firstChild.appendChild(this._tDom),this.hasAppend=!0;this._show(r,o+10,a+10,u)}},_showPolarTrigger:function(e,t){if("undefined"==typeof this.component.polar||"undefined"==typeof e||"undefined"==typeof t||0>t)return!1;var i,s,o,a=this.option.series,n=[],h="";if("axis"==this.option.tooltip.trigger){if(this.option.tooltip.show===!1)return!1;i=this.option.tooltip.formatter,s=this.option.tooltip.position}for(var r=this.option.polar[e].indicator[t].text,p=0,d=a.length;d>p;p++)if(this._isSelected(a[p].name)){if(a[p].polarIndex==e&&"axis"==this.deepQuery([a[p],this.option],"tooltip.trigger"))o=this.query(a[p],"tooltip.showContent")||o,i=this.query(a[p],"tooltip.formatter")||i,s=this.query(a[p],"tooltip.position")||s,h+=this._style(this.query(a[p],"tooltip")),n.push(a[p])}else;if(n.length>0){for(var c,f,u=[],p=0,d=n.length;d>p;p++){c=n[p].data;for(var g=0,y=c.length;y>g;g++)if(f=c[g],this._isSelected(f.name))f="undefined"!=typeof f?f:{name:"",value:{dataIndex:"-"}},u.push([n[p].name||"",f.name,"undefined"!=typeof f.value[t].value?f.value[t].value:f.value[t],r]);else;}if(u.length<=0)return;if("function"==typeof i)this._curTicket="axis:"+t,this._tDom.innerHTML=i.call(this.myChart,u,this._curTicket,this._setContent);else if("string"==typeof i){i=i.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}").replace("{d}","{d0}");for(var p=0,d=u.length;d>p;p++)i=i.replace("{a"+p+"}",this._encodeHTML(u[p][0])),i=i.replace("{b"+p+"}",this._encodeHTML(u[p][1])),i=i.replace("{c"+p+"}",this.numAddCommas(u[p][2])),i=i.replace("{d"+p+"}",this._encodeHTML(u[p][3]));this._tDom.innerHTML=i}else{i=this._encodeHTML(u[0][1])+"<br/>"+this._encodeHTML(u[0][3])+" : "+this.numAddCommas(u[0][2]);for(var p=1,d=u.length;d>p;p++)i+="<br/>"+this._encodeHTML(u[p][1])+"<br/>",i+=this._encodeHTML(u[p][3])+" : "+this.numAddCommas(u[p][2]);this._tDom.innerHTML=i}if(o===!1||!this.option.tooltip.showContent)return;if(!this.hasAppend)this._tDom.style.left=this._zrWidth/2+"px",this._tDom.style.top=this._zrHeight/2+"px",this.dom.firstChild.appendChild(this._tDom),this.hasAppend=!0;return this._show(s,l.getX(this._event),l.getY(this._event),h),!0}},_showItemTrigger:function(){if(this._curTarget){var e,t,i,s,o=h.get(this._curTarget,"series"),a=h.get(this._curTarget,"data"),r=h.get(this._curTarget,"name"),p=h.get(this._curTarget,"value"),d=h.get(this._curTarget,"special"),c=h.get(this._curTarget,"special2"),f="",u="";if("island"!=this._curTarget._type){if("item"==this.option.tooltip.trigger)e=this.option.tooltip.formatter,t=this.option.tooltip.position;if("item"==this.query(o,"tooltip.trigger"))i=this.query(o,"tooltip.showContent")||i,e=this.query(o,"tooltip.formatter")||e,t=this.query(o,"tooltip.position")||t,f+=this._style(this.query(o,"tooltip"));i=this.query(a,"tooltip.showContent")||i,e=this.query(a,"tooltip.formatter")||e,t=this.query(a,"tooltip.position")||t,f+=this._style(this.query(a,"tooltip"))}else i=this.deepQuery([a,o,this.option],"tooltip.showContent"),e=this.deepQuery([a,o,this.option],"tooltip.islandFormatter"),t=this.deepQuery([a,o,this.option],"tooltip.islandPosition");if("function"==typeof e)this._curTicket=(o.name||"")+":"+h.get(this._curTarget,"dataIndex"),this._tDom.innerHTML=e.call(this.myChart,[o.name||"",r,p,d,c,a],this._curTicket,this._setContent);else if("string"==typeof e)this._curTicket=0/0,e=e.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}"),e=e.replace("{a0}",this._encodeHTML(o.name||"")).replace("{b0}",this._encodeHTML(r)).replace("{c0}",p instanceof Array?p:this.numAddCommas(p)),e=e.replace("{d}","{d0}").replace("{d0}",d||""),e=e.replace("{e}","{e0}").replace("{e0}",h.get(this._curTarget,"special2")||""),this._tDom.innerHTML=e;else if(this._curTicket=0/0,o.type==n.CHART_TYPE_SCATTER)this._tDom.innerHTML=("undefined"!=typeof o.name?this._encodeHTML(o.name)+"<br/>":"")+(""===r?"":this._encodeHTML(r)+" : ")+p+("undefined"==typeof d?"":" ("+d+")");else if(o.type==n.CHART_TYPE_RADAR&&d){s=d,u+=this._encodeHTML(""===r?o.name||"":r),u+=""===u?"":"<br />";for(var g=0;g<s.length;g++)u+=this._encodeHTML(s[g].text)+" : "+this.numAddCommas(p[g])+"<br />";this._tDom.innerHTML=u}else if(o.type==n.CHART_TYPE_CHORD)if("undefined"==typeof c)this._tDom.innerHTML=this._encodeHTML(r)+" ("+this.numAddCommas(p)+")";else{var y=this._encodeHTML(r),_=this._encodeHTML(d);this._tDom.innerHTML=("undefined"!=typeof o.name?this._encodeHTML(o.name)+"<br/>":"")+y+" -> "+_+" ("+this.numAddCommas(p)+")<br />"+_+" -> "+y+" ("+this.numAddCommas(c)+")"}else this._tDom.innerHTML=("undefined"!=typeof o.name?this._encodeHTML(o.name)+"<br/>":"")+this._encodeHTML(r)+" : "+this.numAddCommas(p)+("undefined"==typeof d?"":" ("+this.numAddCommas(d)+")");if(!this._axisLineShape.invisible||!this._axisShadowShape.invisible)this._axisLineShape.invisible=!0,this.zr.modShape(this._axisLineShape.id),this._axisShadowShape.invisible=!0,this.zr.modShape(this._axisShadowShape.id),this.zr.refresh();if(i!==!1&&this.option.tooltip.showContent){if(!this.hasAppend)this._tDom.style.left=this._zrWidth/2+"px",this._tDom.style.top=this._zrHeight/2+"px",this.dom.firstChild.appendChild(this._tDom),this.hasAppend=!0;this._show(t,l.getX(this._event)+20,l.getY(this._event)-20,f)}}},_styleAxisPointer:function(e,t,i,s,o,a,n,h){if(e.length>0){var r,l,p=this.option.tooltip.axisPointer,d=p.type,c={line:{},cross:{},shadow:{}};for(var f in c)c[f].color=p[f+"Style"].color,c[f].width=p[f+"Style"].width,c[f].type=p[f+"Style"].type;for(var u=0,g=e.length;g>u;u++)if("axis"==this.deepQuery([e[u],this.option],"tooltip.trigger"))if(r=e[u],l=this.query(r,"tooltip.axisPointer.type"),d=l||d,l)c[l].color=this.query(r,"tooltip.axisPointer."+l+"Style.color")||c[l].color,c[l].width=this.query(r,"tooltip.axisPointer."+l+"Style.width")||c[l].width,c[l].type=this.query(r,"tooltip.axisPointer."+l+"Style.type")||c[l].type;if("line"==d)this._axisLineShape.style={xStart:t,yStart:i,xEnd:s,yEnd:o,strokeColor:c.line.color,lineWidth:c.line.width,lineType:c.line.type},this._axisLineShape.invisible=!1,this.zr.modShape(this._axisLineShape.id);else if("cross"==d){if(this._axisCrossShape.style={brushType:"stroke",rect:this.component.grid.getArea(),x:n,y:h,text:("( "+this.component.xAxis.getAxis(0).getValueFromCoord(n)+" , "+this.component.yAxis.getAxis(0).getValueFromCoord(h)+" )").replace("  , "," ").replace(" ,  "," "),textPosition:"specific",strokeColor:c.cross.color,lineWidth:c.cross.width,lineType:c.cross.type},this.component.grid.getXend()-n>100)this._axisCrossShape.style.textAlign="left",this._axisCrossShape.style.textX=n+10;else this._axisCrossShape.style.textAlign="right",this._axisCrossShape.style.textX=n-10;if(h-this.component.grid.getY()>50)this._axisCrossShape.style.textBaseline="bottom",this._axisCrossShape.style.textY=h-10;else this._axisCrossShape.style.textBaseline="top",this._axisCrossShape.style.textY=h+10;this._axisCrossShape.invisible=!1,this.zr.modShape(this._axisCrossShape.id)}else if("shadow"==d){if("undefined"==typeof c.shadow.width||"auto"==c.shadow.width||isNaN(c.shadow.width))c.shadow.width=a;if(t==s){if(Math.abs(this.component.grid.getX()-t)<2)c.shadow.width/=2,t=s+=c.shadow.width/2;else if(Math.abs(this.component.grid.getXend()-t)<2)c.shadow.width/=2,t=s-=c.shadow.width/2}else if(i==o)if(Math.abs(this.component.grid.getY()-i)<2)c.shadow.width/=2,i=o+=c.shadow.width/2;else if(Math.abs(this.component.grid.getYend()-i)<2)c.shadow.width/=2,i=o-=c.shadow.width/2;this._axisShadowShape.style={xStart:t,yStart:i,xEnd:s,yEnd:o,strokeColor:c.shadow.color,lineWidth:c.shadow.width},this._axisShadowShape.invisible=!1,this.zr.modShape(this._axisShadowShape.id)}this.zr.refresh()}},__onmousemove:function(e){clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket);var t=e.target,i=l.getX(e.event),s=l.getY(e.event);if(!t)if(this._curTarget=!1,this._event=e.event,this._event.zrenderX=i,this._event.zrenderY=s,this._needAxisTrigger&&this.component.grid&&p.isInside(a,this.component.grid.getArea(),i,s))this._showingTicket=setTimeout(this._tryShow,this._showDelay);else if(this._needAxisTrigger&&this.component.polar&&-1!=this.component.polar.isInside([i,s]))this._showingTicket=setTimeout(this._tryShow,this._showDelay);else!this._event.connectTrigger&&this.messageCenter.dispatch(n.EVENT.TOOLTIP_OUT_GRID,this._event,null,this.myChart),this._hidingTicket=setTimeout(this._hide,this._hideDelay);else{this._curTarget=t,this._event=e.event,this._event.zrenderX=i,this._event.zrenderY=s;var o;if(this._needAxisTrigger&&this.component.polar&&-1!=(o=this.component.polar.isInside([i,s])))for(var h=this.option.series,r=0,d=h.length;d>r;r++)if(h[r].polarIndex==o&&"axis"==this.deepQuery([h[r],this.option],"tooltip.trigger")){this._curTarget=null;break}this._showingTicket=setTimeout(this._tryShow,this._showDelay)}},__onglobalout:function(){clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),this._hidingTicket=setTimeout(this._hide,this._hideDelay)},__setContent:function(e,t){if(this._tDom){if(e==this._curTicket)this._tDom.innerHTML=t;setTimeout(this._refixed,20)}},ontooltipHover:function(e,t){if(!this._lastTipShape||this._lastTipShape&&this._lastTipShape.dataIndex!=e.dataIndex){if(this._lastTipShape&&this._lastTipShape.tipShape.length>0)this.zr.delShape(this._lastTipShape.tipShape),this.shapeList.length=2;for(var i=0,s=t.length;s>i;i++)t[i].zlevel=this._zlevelBase,t[i].style=f.prototype.getHighlightStyle(t[i].style,t[i].highlightStyle),t[i].draggable=!1,t[i].hoverable=!1,t[i].clickable=!1,t[i].ondragend=null,t[i].ondragover=null,t[i].ondrop=null,this.shapeList.push(t[i]),this.zr.addShape(t[i]);this._lastTipShape={dataIndex:e.dataIndex,tipShape:t}}},ondragend:function(){this._hide()},onlegendSelected:function(e){this._selectedMap=e.selected},_setSelectedMap:function(){if(this.component.legend)this._selectedMap=c.clone(this.component.legend.getSelectedMap());else this._selectedMap={}},_isSelected:function(e){if("undefined"!=typeof this._selectedMap[e])return this._selectedMap[e];else return!0},showTip:function(e){if(e){var t,i=this.option.series;if("undefined"!=typeof e.seriesIndex)t=e.seriesIndex;else for(var s=e.seriesName,o=0,a=i.length;a>o;o++)if(i[o].name==s){t=o;break}var l=i[t];if("undefined"!=typeof l){var p=this.myChart.chart[l.type],d="axis"==this.deepQuery([l,this.option],"tooltip.trigger");if(p)if(d){var c=e.dataIndex;switch(p.type){case n.CHART_TYPE_LINE:case n.CHART_TYPE_BAR:case n.CHART_TYPE_K:if("undefined"==typeof this.component.xAxis||"undefined"==typeof this.component.yAxis||l.data.length<=c)return;var f=l.xAxisIndex||0,u=l.yAxisIndex||0;if(this.component.xAxis.getAxis(f).type==n.COMPONENT_TYPE_AXIS_CATEGORY)this._event={zrenderX:this.component.xAxis.getAxis(f).getCoordByIndex(c),zrenderY:this.component.grid.getY()+(this.component.grid.getYend()-this.component.grid.getY())/4};else this._event={zrenderX:this.component.grid.getX()+(this.component.grid.getXend()-this.component.grid.getX())/4,zrenderY:this.component.yAxis.getAxis(u).getCoordByIndex(c)};this._showAxisTrigger(f,u,c);break;case n.CHART_TYPE_RADAR:if("undefined"==typeof this.component.polar||l.data[0].value.length<=c)return;var g=l.polarIndex||0,y=this.component.polar.getVector(g,c,"max");this._event={zrenderX:y[0],zrenderY:y[1]},this._showPolarTrigger(g,c)}}else{var _,m,x=p.shapeList;switch(p.type){case n.CHART_TYPE_LINE:case n.CHART_TYPE_BAR:case n.CHART_TYPE_K:case n.CHART_TYPE_SCATTER:for(var c=e.dataIndex,o=0,a=x.length;a>o;o++)if(h.get(x[o],"seriesIndex")==t&&h.get(x[o],"dataIndex")==c){this._curTarget=x[o],_=x[o].style.x,m=p.type!=n.CHART_TYPE_K?x[o].style.y:x[o].style.y[0];break}break;case n.CHART_TYPE_RADAR:for(var c=e.dataIndex,o=0,a=x.length;a>o;o++)if("polygon"==x[o].type&&h.get(x[o],"seriesIndex")==t&&h.get(x[o],"dataIndex")==c){this._curTarget=x[o];var y=this.component.polar.getCenter(l.polarIndex||0);_=y[0],m=y[1];break}break;case n.CHART_TYPE_PIE:for(var v=e.name,o=0,a=x.length;a>o;o++)if("sector"==x[o].type&&h.get(x[o],"seriesIndex")==t&&h.get(x[o],"name")==v){this._curTarget=x[o];var S=this._curTarget.style,b=(S.startAngle+S.endAngle)/2*Math.PI/180;_=this._curTarget.style.x+Math.cos(b)*S.r/1.5,m=this._curTarget.style.y-Math.sin(b)*S.r/1.5;break}break;case n.CHART_TYPE_MAP:for(var v=e.name,z=l.mapType,o=0,a=x.length;a>o;o++)if("text"==x[o].type&&x[o]._mapType==z&&x[o].style._name==v){this._curTarget=x[o],_=this._curTarget.style.x+this._curTarget.position[0],m=this._curTarget.style.y+this._curTarget.position[1];break}break;case n.CHART_TYPE_CHORD:for(var v=e.name,o=0,a=x.length;a>o;o++)if("sector"==x[o].type&&h.get(x[o],"name")==v){this._curTarget=x[o];var S=this._curTarget.style,b=(S.startAngle+S.endAngle)/2*Math.PI/180;return _=this._curTarget.style.x+Math.cos(b)*(S.r-2),m=this._curTarget.style.y-Math.sin(b)*(S.r-2),void this.zr.trigger(r.EVENT.MOUSEMOVE,{zrenderX:_,zrenderY:m})}break;case n.CHART_TYPE_FORCE:for(var v=e.name,o=0,a=x.length;a>o;o++)if("circle"==x[o].type&&h.get(x[o],"name")==v){this._curTarget=x[o],_=this._curTarget.position[0],m=this._curTarget.position[1];break}}if("undefined"!=typeof _&&"undefined"!=typeof m)this._event={zrenderX:_,zrenderY:m},this.zr.addHoverShape(this._curTarget),this.zr.refreshHover(),this._showItemTrigger()}}}},hideTip:function(){this._hide()},refresh:function(e){if(this._zrHeight=this.zr.getHeight(),this._zrWidth=this.zr.getWidth(),this._lastTipShape&&this._lastTipShape.tipShape.length>0)this.zr.delShape(this._lastTipShape.tipShape);if(this._lastTipShape=!1,this.shapeList.length=2,e){if(this.option=e,this.option.tooltip=this.reformOption(this.option.tooltip),this.option.tooltip.textStyle=c.merge(this.option.tooltip.textStyle,this.ecTheme.textStyle),this.option.tooltip.padding=this.reformCssArray(this.option.tooltip.padding),this._needAxisTrigger=!1,"axis"==this.option.tooltip.trigger)this._needAxisTrigger=!0;for(var t=this.option.series,i=0,s=t.length;s>i;i++)if("axis"==this.query(t[i],"tooltip.trigger")){this._needAxisTrigger=!0;break}this._showDelay=this.option.tooltip.showDelay,this._hideDelay=this.option.tooltip.hideDelay,this._defaultCssText=this._style(this.option.tooltip),this._setSelectedMap(),this._axisLineWidth=this.option.tooltip.axisPointer.lineStyle.width}if(this.showing){var o=this;setTimeout(function(){o.zr.trigger(r.EVENT.MOUSEMOVE,o.zr.handler._event)},50)}},dispose:function(){if(this._lastTipShape&&this._lastTipShape.tipShape.length>0)this.zr.delShape(this._lastTipShape.tipShape);if(this.clear(),this.shapeList=null,clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),this.zr.un(r.EVENT.MOUSEMOVE,this._onmousemove),this.zr.un(r.EVENT.GLOBALOUT,this._onglobalout),this.hasAppend)this.dom.firstChild.removeChild(this._tDom);this._tDom=null},_encodeHTML:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}},c.inherits(e,t),require("../component").define("tooltip",e),e});