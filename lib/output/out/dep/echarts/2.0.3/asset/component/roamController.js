/*! @2014 Leo Wang. All Rights Reserved */
define("echarts/component/roamController",["require","./base","zrender/shape/Rectangle","zrender/shape/Sector","zrender/shape/Circle","../config","zrender/tool/util","zrender/tool/color","zrender/tool/event","../component"],function(require){function e(e,i,s,a,o){if(a.roamController&&a.roamController.show){if(!a.roamController.mapTypeControl)return void console.error("option.roamController.mapTypeControl has not been defined.");t.call(this,e,i,s,a,o),this.rcOption=a.roamController;var n=this;this._drictionMouseDown=function(e){return n.__drictionMouseDown(e)},this._drictionMouseUp=function(e){return n.__drictionMouseUp(e)},this._drictionMouseMove=function(e){return n.__drictionMouseMove(e)},this._drictionMouseOut=function(e){return n.__drictionMouseOut(e)},this._scaleHandler=function(e){return n.__scaleHandler(e)},this.refresh(a)}}var t=require("./base"),i=require("zrender/shape/Rectangle"),s=require("zrender/shape/Sector"),a=require("zrender/shape/Circle"),o=require("../config"),n=require("zrender/tool/util"),h=require("zrender/tool/color"),r=require("zrender/tool/event");return e.prototype={type:o.COMPONENT_TYPE_ROAMCONTROLLER,_buildShape:function(){this._itemGroupLocation=this._getItemGroupLocation(),this._buildBackground(),this._buildItem();for(var e=0,t=this.shapeList.length;t>e;e++)this.zr.addShape(this.shapeList[e])},_buildItem:function(){this.shapeList.push(this._getDirectionShape("up")),this.shapeList.push(this._getDirectionShape("down")),this.shapeList.push(this._getDirectionShape("left")),this.shapeList.push(this._getDirectionShape("right")),this.shapeList.push(this._getScaleShape("scaleUp")),this.shapeList.push(this._getScaleShape("scaleDown"))},_getDirectionShape:function(e){var t=this._itemGroupLocation.r,i=this._itemGroupLocation.x+t,a=this._itemGroupLocation.y+t,o={zlevel:this._zlevelBase,style:{x:i,y:a,r:t,startAngle:-45,endAngle:45,color:this.rcOption.handlerColor,text:">",textX:i+t/2+4,textY:a-.5,textAlign:"center",textBaseline:"middle",textPosition:"specific",textColor:this.rcOption.fillerColor,textFont:Math.floor(t/2)+"px arial"},highlightStyle:{color:h.lift(this.rcOption.handlerColor,-.2),brushType:"fill"},clickable:!0};switch(e){case"up":o.rotation=[Math.PI/2,i,a];break;case"left":o.rotation=[Math.PI,i,a];break;case"down":o.rotation=[-Math.PI/2,i,a]}return o=new s(o),o._roamType=e,o.onmousedown=this._drictionMouseDown,o.onmouseup=this._drictionMouseUp,o.onmousemove=this._drictionMouseMove,o.onmouseout=this._drictionMouseOut,o},_getScaleShape:function(e){var t=this._itemGroupLocation.width,i=this._itemGroupLocation.height-t;i=0>i?20:i;var s=Math.min(t/2-5,i)/2,o=this._itemGroupLocation.x+("scaleDown"==e?t-s:s),n=this._itemGroupLocation.y+this._itemGroupLocation.height-s,r={zlevel:this._zlevelBase,style:{x:o,y:n,r:s,color:this.rcOption.handlerColor,text:"scaleDown"==e?"-":"+",textX:o,textY:n-2,textAlign:"center",textBaseline:"middle",textPosition:"specific",textColor:this.rcOption.fillerColor,textFont:Math.floor(s)+"px verdana"},highlightStyle:{color:h.lift(this.rcOption.handlerColor,-.2),brushType:"fill"},clickable:!0};return r=new a(r),r._roamType=e,r.onmousedown=this._scaleHandler,r},_buildBackground:function(){var e=this.rcOption.padding[0],t=this.rcOption.padding[1],s=this.rcOption.padding[2],a=this.rcOption.padding[3];this.shapeList.push(new i({zlevel:this._zlevelBase,hoverable:!1,style:{x:this._itemGroupLocation.x-a,y:this._itemGroupLocation.y-e,width:this._itemGroupLocation.width+a+t,height:this._itemGroupLocation.height+e+s,brushType:0===this.rcOption.borderWidth?"fill":"both",color:this.rcOption.backgroundColor,strokeColor:this.rcOption.borderColor,lineWidth:this.rcOption.borderWidth}}))},_getItemGroupLocation:function(){var e,t=this.rcOption.padding,i=this.rcOption.width,s=this.rcOption.height,a=this.zr.getWidth(),o=this.zr.getHeight();switch(this.rcOption.x){case"center":e=Math.floor((a-i)/2);break;case"left":e=t[3]+this.rcOption.borderWidth;break;case"right":e=a-i-t[1]-t[3]-2*this.rcOption.borderWidth;break;default:e=this.parsePercent(this.rcOption.x,a)}var n;switch(this.rcOption.y){case"top":n=t[0]+this.rcOption.borderWidth;break;case"bottom":n=o-s-t[0]-t[2]-2*this.rcOption.borderWidth;break;case"center":n=Math.floor((o-s)/2);break;default:n=this.parsePercent(this.rcOption.y,o)}return{x:e,y:n,r:i/2,width:i,height:s}},__drictionMouseDown:function(e){this.mousedown=!0,this._drictionHandlerOn(e)},__drictionMouseUp:function(e){this.mousedown=!1,this._drictionHandlerOff(e)},__drictionMouseMove:function(e){if(this.mousedown)this._drictionHandlerOn(e)},__drictionMouseOut:function(e){this._drictionHandlerOff(e)},_drictionHandlerOn:function(e){this._dispatchEvent(e.event,e.target._roamType),clearInterval(this.dircetionTimer);var t=this;this.dircetionTimer=setInterval(function(){t._dispatchEvent(e.event,e.target._roamType)},100)},_drictionHandlerOff:function(){clearInterval(this.dircetionTimer)},__scaleHandler:function(e){this._dispatchEvent(e.event,e.target._roamType)},_dispatchEvent:function(e,t){this.messageCenter.dispatch(o.EVENT.ROAMCONTROLLER,e,{roamType:t,mapTypeControl:this.rcOption.mapTypeControl,step:this.rcOption.step},this.myChart),r.stop(e)},refresh:function(e){if(e)this.option=e||this.option,this.option.roamController=this.reformOption(this.option.roamController),this.option.roamController.padding=this.reformCssArray(this.option.roamController.padding),this.rcOption=this.option.roamController;this.clear(),this._buildShape()}},n.inherits(e,t),require("../component").define("roamController",e),e});