/*! @2014 Leo Wang. All Rights Reserved */
define("echarts/component/categoryAxis",["require","./base","zrender/shape/Text","zrender/shape/Line","zrender/shape/Rectangle","../config","zrender/tool/util","zrender/tool/area","../component"],function(require){function e(e,i,s,a,o,r){if(a.data.length<1)return void console.error("option.data.length < 1.");t.call(this,e,i,s,a,o),this.grid=this.component.grid;for(var n in r)this[n]=r[n];this.refresh(a)}var t=require("./base"),i=require("zrender/shape/Text"),s=require("zrender/shape/Line"),a=require("zrender/shape/Rectangle"),o=require("../config"),r=require("zrender/tool/util"),n=require("zrender/tool/area");return e.prototype={type:o.COMPONENT_TYPE_AXIS_CATEGORY,_getReformedLabel:function(e){var t="undefined"!=typeof this.option.data[e].value?this.option.data[e].value:this.option.data[e],i=this.option.data[e].formatter||this.option.axisLabel.formatter;if(i)if("function"==typeof i)t=i.call(this.myChart,t);else if("string"==typeof i)t=i.replace("{value}",t);return t},_getInterval:function(){var e=this.option.axisLabel.interval;if("auto"==e){var t=this.option.axisLabel.textStyle.fontSize,i=this.option.data,s=this.option.data.length;if(this.isHorizontal())if(s>3){var a,o,h=this.getGap(),l=!1,p=Math.floor(.5/h);for(p=1>p?1:p,e=Math.floor(15/h);!l&&s>e;){e+=p,l=!0,a=Math.floor(h*e);for(var d=Math.floor((s-1)/e)*e;d>=0;d-=e){if(0!==this.option.axisLabel.rotate)o=t;else if(i[d].textStyle)o=n.getTextWidth(this._getReformedLabel(d),this.getFont(r.merge(i[d].textStyle,this.option.axisLabel.textStyle)));else{var c=this._getReformedLabel(d)+"",f=(c.match(/\w/g)||"").length,u=c.length-f;o=f*t*2/3+u*t}if(o>a){l=!1;break}}}}else e=1;else if(s>3){var h=this.getGap();for(e=Math.floor(11/h);t>h*e-6&&s>e;)e++}else e=1}else e=e-0+1;return e},_buildShape:function(){this._interval=this._getInterval(),this.option.splitArea.show&&this._buildSplitArea(),this.option.splitLine.show&&this._buildSplitLine(),this.option.axisLine.show&&this._buildAxisLine(),this.option.axisTick.show&&this._buildAxisTick(),this.option.axisLabel.show&&this._buildAxisLabel();for(var e=0,t=this.shapeList.length;t>e;e++)this.zr.addShape(this.shapeList[e])},_buildAxisTick:function(){var e,t=this.option.data.length,i=this.option.axisTick,a=i.length,o=i.lineStyle.color,r=i.lineStyle.width,n="auto"==i.interval?this._interval:i.interval-0+1,h=i.onGap,l=h?this.getGap()/2:"undefined"==typeof h?this.option.boundaryGap?this.getGap()/2:0:0,p=l>0?-n:0;if(this.isHorizontal())for(var d,c="bottom"==this.option.position?i.inside?this.grid.getYend()-a-1:this.grid.getYend()+1:i.inside?this.grid.getY()+1:this.grid.getY()-a-1,f=p;t>f;f+=n)d=this.subPixelOptimize(this.getCoordByIndex(f)+(f>=0?l:0),r),e={_axisShape:"axisTick",zlevel:this._zlevelBase,hoverable:!1,style:{xStart:d,yStart:c,xEnd:d,yEnd:c+a,strokeColor:o,lineWidth:r}},this.shapeList.push(new s(e));else for(var u,g="left"==this.option.position?i.inside?this.grid.getX()+1:this.grid.getX()-a-1:i.inside?this.grid.getXend()-a-1:this.grid.getXend()+1,f=p;t>f;f+=n)u=this.subPixelOptimize(this.getCoordByIndex(f)-(f>=0?l:0),r),e={_axisShape:"axisTick",zlevel:this._zlevelBase,hoverable:!1,style:{xStart:g,yStart:u,xEnd:g+a,yEnd:u,strokeColor:o,lineWidth:r}},this.shapeList.push(new s(e))},_buildAxisLabel:function(){var e,t,s=this.option.data,a=this.option.data.length,o=this.option.axisLabel.rotate,n=this.option.axisLabel.margin,h=this.option.axisLabel.clickable,l=this.option.axisLabel.textStyle;if(this.isHorizontal()){var p,d;if("bottom"==this.option.position)p=this.grid.getYend()+n,d="top";else p=this.grid.getY()-n,d="bottom";for(var c=0;a>c;c+=this._interval)if(""!==this._getReformedLabel(c)){if(t=r.merge(s[c].textStyle||{},l),e={zlevel:this._zlevelBase,hoverable:!1,style:{x:this.getCoordByIndex(c),y:p,color:t.color,text:this._getReformedLabel(c),textFont:this.getFont(t),textAlign:t.align||"center",textBaseline:t.baseline||d}},o)e.style.textAlign=o>0?"bottom"==this.option.position?"right":"left":"bottom"==this.option.position?"left":"right",e.rotation=[o*Math.PI/180,e.style.x,e.style.y];this.shapeList.push(new i(this._axisLabelClickable(h,e)))}else;}else{var f,u;if("left"==this.option.position)f=this.grid.getX()-n,u="right";else f=this.grid.getXend()+n,u="left";for(var c=0;a>c;c+=this._interval)if(""!==this._getReformedLabel(c)){if(t=r.merge(s[c].textStyle||{},l),e={zlevel:this._zlevelBase,hoverable:!1,style:{x:f,y:this.getCoordByIndex(c),color:t.color,text:this._getReformedLabel(c),textFont:this.getFont(t),textAlign:t.align||u,textBaseline:t.baseline||0===c&&""!==this.option.name?"bottom":c==a-1&&""!==this.option.name?"top":"middle"}},o)e.rotation=[o*Math.PI/180,e.style.x,e.style.y];this.shapeList.push(new i(this._axisLabelClickable(h,e)))}else;}},_buildSplitLine:function(){var e,t=this.option.data.length,i=this.option.splitLine,a=i.lineStyle.type,o=i.lineStyle.width,r=i.lineStyle.color;r=r instanceof Array?r:[r];var n=r.length,h=i.onGap,l=h?this.getGap()/2:"undefined"==typeof h?this.option.boundaryGap?this.getGap()/2:0:0;if(t-=h||"undefined"==typeof h&&this.option.boundaryGap?1:0,this.isHorizontal())for(var p,d=this.grid.getY(),c=this.grid.getYend(),f=0;t>f;f+=this._interval)p=this.subPixelOptimize(this.getCoordByIndex(f)+l,o),e={zlevel:this._zlevelBase,hoverable:!1,style:{xStart:p,yStart:d,xEnd:p,yEnd:c,strokeColor:r[f/this._interval%n],lineType:a,lineWidth:o}},this.shapeList.push(new s(e));else for(var u,g=this.grid.getX(),y=this.grid.getXend(),f=0;t>f;f+=this._interval)u=this.subPixelOptimize(this.getCoordByIndex(f)-l,o),e={zlevel:this._zlevelBase,hoverable:!1,style:{xStart:g,yStart:u,xEnd:y,yEnd:u,strokeColor:r[f/this._interval%n],linetype:a,lineWidth:o}},this.shapeList.push(new s(e))},_buildSplitArea:function(){var e,t=this.option.splitArea,i=t.areaStyle.color;if(!(i instanceof Array))e={zlevel:this._zlevelBase,hoverable:!1,style:{x:this.grid.getX(),y:this.grid.getY(),width:this.grid.getWidth(),height:this.grid.getHeight(),color:i}},this.shapeList.push(new a(e));else{var s=i.length,o=this.option.data.length,r=t.onGap,n=r?this.getGap()/2:"undefined"==typeof r?this.option.boundaryGap?this.getGap()/2:0:0;if(this.isHorizontal())for(var h,l=this.grid.getY(),p=this.grid.getHeight(),d=this.grid.getX(),c=0;o>=c;c+=this._interval)h=o>c?this.getCoordByIndex(c)+n:this.grid.getXend(),e={zlevel:this._zlevelBase,hoverable:!1,style:{x:d,y:l,width:h-d,height:p,color:i[c/this._interval%s]}},this.shapeList.push(new a(e)),d=h;else for(var f,u=this.grid.getX(),g=this.grid.getWidth(),y=this.grid.getYend(),c=0;o>=c;c+=this._interval)f=o>c?this.getCoordByIndex(c)-n:this.grid.getY(),e={zlevel:this._zlevelBase,hoverable:!1,style:{x:u,y:f,width:g,height:y-f,color:i[c/this._interval%s]}},this.shapeList.push(new a(e)),y=f}},refresh:function(e){if(e)this.option=this.reformOption(e),this.option.axisLabel.textStyle=r.merge(this.option.axisLabel.textStyle||{},this.ecTheme.textStyle);this.clear(),this._buildShape()},getGap:function(){var e=this.option.data.length,t=this.isHorizontal()?this.grid.getWidth():this.grid.getHeight();if(this.option.boundaryGap)return t/e;else return t/(e>1?e-1:1)},getCoord:function(e){for(var t=this.option.data,i=t.length,s=this.getGap(),a=this.option.boundaryGap?s/2:0,o=0;i>o;o++){if(t[o]==e||"undefined"!=typeof t[o].value&&t[o].value==e){if(this.isHorizontal())a=this.grid.getX()+a;else a=this.grid.getYend()-a;return a}a+=s}},getCoordByIndex:function(e){if(0>e)if(this.isHorizontal())return this.grid.getX();else return this.grid.getYend();else if(e>this.option.data.length-1)if(this.isHorizontal())return this.grid.getXend();else return this.grid.getY();else{var t=this.getGap(),i=this.option.boundaryGap?t/2:0;if(i+=e*t,this.isHorizontal())i=this.grid.getX()+i;else i=this.grid.getYend()-i;return i}},getNameByIndex:function(e){var t=this.option.data[e];if("undefined"!=typeof t&&"undefined"!=typeof t.value)return t.value;else return t},getIndexByName:function(e){for(var t=this.option.data,i=t.length,s=0;i>s;s++)if(t[s]==e||"undefined"!=typeof t[s].value&&t[s].value==e)return s;return-1},getValueFromCoord:function(){return""},isMainAxis:function(e){return e%this._interval===0}},r.inherits(e,t),require("../component").define("categoryAxis",e),e});