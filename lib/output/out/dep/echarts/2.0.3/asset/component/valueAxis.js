/*! @2014 Leo Wang. All Rights Reserved */
define("echarts/component/valueAxis",["require","./base","zrender/shape/Text","zrender/shape/Line","zrender/shape/Rectangle","../config","zrender/tool/util","../component"],function(require){function t(t,i,s,o,a,n,h){if(!h||0===h.length)return void console.err("option.series.length == 0.");e.call(this,t,i,s,o,a),this.series=h,this.grid=this.component.grid;for(var r in n)this[r]=n[r];this.refresh(o,h)}var e=require("./base"),i=require("zrender/shape/Text"),s=require("zrender/shape/Line"),o=require("zrender/shape/Rectangle"),a=require("../config"),n=require("zrender/tool/util");return t.prototype={type:a.COMPONENT_TYPE_AXIS_VALUE,_buildShape:function(){if(this._hasData=!1,this._calculateValue(),this._hasData){this.option.splitArea.show&&this._buildSplitArea(),this.option.splitLine.show&&this._buildSplitLine(),this.option.axisLine.show&&this._buildAxisLine(),this.option.axisTick.show&&this._buildAxisTick(),this.option.axisLabel.show&&this._buildAxisLabel();for(var t=0,e=this.shapeList.length;e>t;t++)this.zr.addShape(this.shapeList[t])}},_buildAxisTick:function(){var t,e=this._valueList,i=this._valueList.length,o=this.option.axisTick,a=o.length,n=o.lineStyle.color,h=o.lineStyle.width;if(this.isHorizontal())for(var r,l="bottom"==this.option.position?o.inside?this.grid.getYend()-a-1:this.grid.getYend()+1:o.inside?this.grid.getY()+1:this.grid.getY()-a-1,p=0;i>p;p++)r=this.subPixelOptimize(this.getCoord(e[p]),h),t={_axisShape:"axisTick",zlevel:this._zlevelBase,hoverable:!1,style:{xStart:r,yStart:l,xEnd:r,yEnd:l+a,strokeColor:n,lineWidth:h}},this.shapeList.push(new s(t));else for(var d,c="left"==this.option.position?o.inside?this.grid.getX()+1:this.grid.getX()-a-1:o.inside?this.grid.getXend()-a-1:this.grid.getXend()+1,p=0;i>p;p++)d=this.subPixelOptimize(this.getCoord(e[p]),h),t={_axisShape:"axisTick",zlevel:this._zlevelBase,hoverable:!1,style:{xStart:c,yStart:d,xEnd:c+a,yEnd:d,strokeColor:n,lineWidth:h}},this.shapeList.push(new s(t))},_buildAxisLabel:function(){var t,e=this._valueList,s=this._valueList.length,o=this.option.axisLabel.rotate,a=this.option.axisLabel.margin,n=this.option.axisLabel.clickable,h=this.option.axisLabel.textStyle;if(this.isHorizontal()){var r,l;if("bottom"==this.option.position)r=this.grid.getYend()+a,l="top";else r=this.grid.getY()-a,l="bottom";for(var p=0;s>p;p++){if(t={zlevel:this._zlevelBase,hoverable:!1,style:{x:this.getCoord(e[p]),y:r,color:"function"==typeof h.color?h.color(e[p]):h.color,text:this._valueLabel[p],textFont:this.getFont(h),textAlign:h.align||"center",textBaseline:h.baseline||l}},o)t.style.textAlign=o>0?"bottom"==this.option.position?"right":"left":"bottom"==this.option.position?"left":"right",t.rotation=[o*Math.PI/180,t.style.x,t.style.y];this.shapeList.push(new i(this._axisLabelClickable(n,t)))}}else{var d,c;if("left"==this.option.position)d=this.grid.getX()-a,c="right";else d=this.grid.getXend()+a,c="left";for(var p=0;s>p;p++){if(t={zlevel:this._zlevelBase,hoverable:!1,style:{x:d,y:this.getCoord(e[p]),color:"function"==typeof h.color?h.color(e[p]):h.color,text:this._valueLabel[p],textFont:this.getFont(h),textAlign:h.align||c,textBaseline:h.baseline||0===p&&""!==this.option.name?"bottom":p==s-1&&""!==this.option.name?"top":"middle"}},o)t.rotation=[o*Math.PI/180,t.style.x,t.style.y];this.shapeList.push(new i(this._axisLabelClickable(n,t)))}}},_buildSplitLine:function(){var t,e=this._valueList,i=this._valueList.length,o=this.option.splitLine,a=o.lineStyle.type,n=o.lineStyle.width,h=o.lineStyle.color;h=h instanceof Array?h:[h];var r=h.length;if(this.isHorizontal())for(var l,p=this.grid.getY(),d=this.grid.getYend(),c=0;i>c;c++)l=this.subPixelOptimize(this.getCoord(e[c]),n),t={zlevel:this._zlevelBase,hoverable:!1,style:{xStart:l,yStart:p,xEnd:l,yEnd:d,strokeColor:h[c%r],lineType:a,lineWidth:n}},this.shapeList.push(new s(t));else for(var f,u=this.grid.getX(),g=this.grid.getXend(),c=0;i>c;c++)f=this.subPixelOptimize(this.getCoord(e[c]),n),t={zlevel:this._zlevelBase,hoverable:!1,style:{xStart:u,yStart:f,xEnd:g,yEnd:f,strokeColor:h[c%r],lineType:a,lineWidth:n}},this.shapeList.push(new s(t))},_buildSplitArea:function(){var t,e=this.option.splitArea.areaStyle.color;if(!(e instanceof Array))t={zlevel:this._zlevelBase,hoverable:!1,style:{x:this.grid.getX(),y:this.grid.getY(),width:this.grid.getWidth(),height:this.grid.getHeight(),color:e}},this.shapeList.push(new o(t));else{var i=e.length,s=this._valueList,a=this._valueList.length;if(this.isHorizontal())for(var n,h=this.grid.getY(),r=this.grid.getHeight(),l=this.grid.getX(),p=0;a>=p;p++)n=a>p?this.getCoord(s[p]):this.grid.getXend(),t={zlevel:this._zlevelBase,hoverable:!1,style:{x:l,y:h,width:n-l,height:r,color:e[p%i]}},this.shapeList.push(new o(t)),l=n;else for(var d,c=this.grid.getX(),f=this.grid.getWidth(),u=this.grid.getYend(),p=0;a>=p;p++)d=a>p?this.getCoord(s[p]):this.grid.getY(),t={zlevel:this._zlevelBase,hoverable:!1,style:{x:c,y:d,width:f,height:u-d,color:e[p%i]}},this.shapeList.push(new o(t)),u=d}},_calculateValue:function(){if(isNaN(this.option.min-0)||isNaN(this.option.max-0)){for(var t,e,i,s,o={},n=this.component.legend,h=0,r=this.series.length;r>h;h++)if(this.series[h].type==a.CHART_TYPE_LINE||this.series[h].type==a.CHART_TYPE_BAR||this.series[h].type==a.CHART_TYPE_SCATTER||this.series[h].type==a.CHART_TYPE_K)if(!n||n.isSelected(this.series[h].name))if(i=this.series[h].xAxisIndex||0,s=this.series[h].yAxisIndex||0,this.option.xAxisIndex==i||this.option.yAxisIndex==s){var l=this.series[h].name||"kener";if(!this.series[h].stack){o[l]=o[l]||[],t=this.series[h].data;for(var p=0,d=t.length;d>p;p++)if(e="undefined"!=typeof t[p].value?t[p].value:t[p],this.series[h].type==a.CHART_TYPE_SCATTER){if(-1!=this.option.xAxisIndex)o[l].push(e[0]);if(-1!=this.option.yAxisIndex)o[l].push(e[1])}else if(this.series[h].type==a.CHART_TYPE_K)o[l].push(e[0]),o[l].push(e[1]),o[l].push(e[2]),o[l].push(e[3]);else o[l].push(e)}else{var c="__Magic_Key_Positive__"+this.series[h].stack,f="__Magic_Key_Negative__"+this.series[h].stack;o[c]=o[c]||[],o[f]=o[f]||[],o[l]=o[l]||[],t=this.series[h].data;for(var p=0,d=t.length;d>p;p++)if(e="undefined"!=typeof t[p].value?t[p].value:t[p],"-"!=e){if(e-=0,e>=0)if("undefined"!=typeof o[c][p])o[c][p]+=e;else o[c][p]=e;else if("undefined"!=typeof o[f][p])o[f][p]+=e;else o[f][p]=e;if(this.option.scale)o[l].push(e)}else;}}else;else;else;for(var h in o){t=o[h];for(var p=0,d=t.length;d>p;p++)if(!isNaN(t[p])){this._hasData=!0,this._min=t[p],this._max=t[p];break}if(this._hasData)break}for(var h in o){t=o[h];for(var p=0,d=t.length;d>p;p++)if(!isNaN(t[p]))this._min=Math.min(this._min,t[p]),this._max=Math.max(this._max,t[p])}var u=Math.abs(this._max-this._min);if(this._min=isNaN(this.option.min-0)?this._min-Math.abs(u*this.option.boundaryGap[0]):this.option.min-0,this._max=isNaN(this.option.max-0)?this._max+Math.abs(u*this.option.boundaryGap[1]):this.option.max-0,this._min==this._max)if(0===this._max)this._max=this.option.power>0?this.option.power:1;else if(this._max>0)this._min=this._max/this.option.splitNumber;else this._max=this._max/this.option.splitNumber;this._reformValue(this.option.scale)}else this._hasData=!0,this._min=this.option.min-0,this._max=this.option.max-0,this._customerValue()},_reformValue:function(t){var e,i,s=this.option.splitNumber,o=this.option.precision;if(0===o)i=this.option.power>1?this.option.power:1;else i=Math.pow(10,o),this._min*=i,this._max*=i,i=this.option.power;var a;if(this._min>=0&&this._max>=0){if(!t){for(;this._max/i<s&&1!=i;)i/=10;this._min=0}else{for(;this._min<i&&1!=i;)i/=10;if(0===o)this._min=Math.floor(this._min/i)*i,this._max=Math.ceil(this._max/i)*i}i=i>1?i/10:1,a=this._max-this._min,e=Math.ceil(a/s/i)*i,this._max=this._min+e*s}else if(this._min<=0&&this._max<=0){if(i=-i,!t){for(;this._min/i<s&&-1!=i;)i/=10;this._max=0}else{for(;this._max>i&&-1!=i;)i/=10;if(0===o)this._min=Math.ceil(this._min/i)*i,this._max=Math.floor(this._max/i)*i}i=-1>i?i/10:-1,a=this._min-this._max,e=-Math.ceil(a/s/i)*i,this._min=-e*s+this._max}else{for(a=this._max-this._min;s>a/i&&1!=i;)i/=10;var n=Math.round(this._max/a*s);n-=n==s?1:0,n+=0===n?1:0,e=Math.ceil(Math.max(this._max/n,this._min/(n-s))/i)*i,this._max=e*n,this._min=e*(n-s)}this._valueList=[];for(var h=0;s>=h;h++)this._valueList.push(this._min+e*h);if(0!==o){i=Math.pow(10,o),this._min=(this._min/i).toFixed(o)-0,this._max=(this._max/i).toFixed(o)-0;for(var h=0;s>=h;h++)this._valueList[h]=(this._valueList[h]/i).toFixed(o)-0}this._reformLabelData()},_customerValue:function(){var t=this.option.splitNumber,e=this.option.precision,i=(this._max-this._min)/t;this._valueList=[];for(var s=0;t>=s;s++)this._valueList.push((this._min+i*s).toFixed(e)-0);this._reformLabelData()},_reformLabelData:function(){this._valueLabel=[];var t=this.option.axisLabel.formatter;if(t){for(var e=0,i=this._valueList.length;i>e;e++)if("function"==typeof t)this._valueLabel.push(t.call(this.myChart,this._valueList[e]));else if("string"==typeof t)this._valueLabel.push(t.replace("{value}",this._valueList[e]))}else for(var e=0,i=this._valueList.length;i>e;e++)this._valueLabel.push(this.numAddCommas(this._valueList[e]))},getExtremum:function(){return this._calculateValue(),{min:this._min,max:this._max}},refresh:function(t,e){if(t)this.option=this.reformOption(t),this.option.axisLabel.textStyle=n.merge(this.option.axisLabel.textStyle||{},this.ecTheme.textStyle),this.series=e;if(this.zr)this.clear(),this._buildShape()},getCoord:function(t){t=t<this._min?this._min:t,t=t>this._max?this._max:t;var e;if(!this.isHorizontal())e=this.grid.getYend()-(t-this._min)/(this._max-this._min)*this.grid.getHeight();else e=this.grid.getX()+(t-this._min)/(this._max-this._min)*this.grid.getWidth();return e},getCoordSize:function(t){if(!this.isHorizontal())return Math.abs(t/(this._max-this._min)*this.grid.getHeight());else return Math.abs(t/(this._max-this._min)*this.grid.getWidth())},getValueFromCoord:function(t){var e;if(!this.isHorizontal())t=t<this.grid.getY()?this.grid.getY():t,t=t>this.grid.getYend()?this.grid.getYend():t,e=this._max-(t-this.grid.getY())/this.grid.getHeight()*(this._max-this._min);else t=t<this.grid.getX()?this.grid.getX():t,t=t>this.grid.getXend()?this.grid.getXend():t,e=this._min+(t-this.grid.getX())/this.grid.getWidth()*(this._max-this._min);return e.toFixed(2)-0}},n.inherits(t,e),require("../component").define("valueAxis",t),t});