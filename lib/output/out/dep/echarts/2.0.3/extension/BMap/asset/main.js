/*! @2014 Leo Wang. All Rights Reserved */
define(["require"],function(){function e(e,t,n){this.init(e,t,n)}return e.prototype._echartsContainer=null,e.prototype._map=null,e.prototype._ec=null,e.prototype._geoCoord=[],e.prototype._mapOffset=[0,0],e.prototype.init=function(e,t,n){function o(){}function r(){p("zoom")}function a(e){return function(){var t=f._echartsContainer.parentNode.parentNode.parentNode;f._mapOffset=[-parseInt(t.style.left)||0,-parseInt(t.style.top)||0],f._echartsContainer.style.left=f._mapOffset[0]+"px",f._echartsContainer.style.top=f._mapOffset[1]+"px",p(e)}}function i(e){return function(){var t=e?"disableDragging":"enableDragging";f._map[t]()}}function p(e){var t=f["on"+e];if(t)t();else f.refresh()}var f=this;f._map=e.constructor==t.Map?e:new t.Map(e),o.prototype=new t.Overlay,o.prototype.initialize=function(e){var t=e.getSize(),n=f._echartsContainer=document.createElement("div");return n.style.position="absolute",n.style.height=t.height+"px",n.style.width=t.width+"px",n.style.top=0,n.style.left=0,e.getPanes().labelPane.appendChild(n),n},o.prototype.draw=function(){};var s=new o;f.getEchartsContainer=function(){return f._echartsContainer},f.getMap=function(){return f._map},f.onmoving=null,f.onmoveend=null,f.onzoom=null,f.geoCoord2Pixel=function(e){var n=new t.Point(e[0],e[1]),o=f._map.pointToOverlayPixel(n);return[o.x,o.y]},f.pixel2GeoCoord=function(e){var t=f._map.overlayPixelToPoint({x:e[0],y:e[1]});return[t.lng,t.lat]},f.initECharts=function(){return f._ec=n.init.apply(f,arguments),f._bindEvent(),f._ec},f.getECharts=function(){return f._ec},f.getMapOffset=function(){return f._mapOffset},f.setOption=function(e){for(var t,n=e.series||{},o=0;t=n[o++];){var r=t.geoCoord;if(r)for(var a in r)f._geoCoord[a]=r[a]}for(var t,o=0;t=n[o++];){var i=t.markPoint||{},p=t.markLine||{},s=i.data;if(s&&s.length)for(var a in s)f._AddPos(s[a]);if(s=p.data,s&&s.length)for(var a in s)f._AddPos(s[a][0]),f._AddPos(s[a][1])}f._ec.setOption(e)},f._AddPos=function(e){var t=this._geoCoord[e.name],n=this.geoCoord2Pixel(t);e.x=n[0]-f._mapOffset[0],e.y=n[1]-f._mapOffset[1]},f._bindEvent=function(){f._map.addEventListener("zoomend",r),f._map.addEventListener("moving",a("moving")),f._map.addEventListener("moveend",a("moveend")),f._ec.getZrender().on("dragstart",i(!0)),f._ec.getZrender().on("dragend",i(!1))},f.refresh=function(){if(f._ec){var e=f._ec.getOption();f.setOption(e)}},f._map.addOverlay(s)},e});