/*! @2014 Leo Wang. All Rights Reserved */
define(["require","zrender/tool/http","zrender/shape/Circle","zrender/shape/Ellipse","zrender/shape/Rectangle","zrender/shape/Line","zrender/shape/Path","zrender/shape/Polygon","zrender/shape/Text","zrender/shape/Image","zrender/shape/BrokenLine","zrender/tool/matrix","zrender/tool/vector","zrender/tool/log","zrender/tool/guid","zrender/Group","zrender/tool/util"],function(require){"use strict";function e(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function t(e,t,n,a){if("object"==typeof e){var r=e;e=r.url,t=r.onsuccess,n=r.onerror,a=r}else if("object"==typeof n)a=n;V.get(e,function(e){t(i(e,a))},n)}function n(e){try{var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);if(!t||!t.documentElement||t.getElementsByTagName("parsererror").length)W("Invalid XML: "+e);else return t}catch(i){return null}}function i(e,t){if(t=t||{},"undefined"==typeof t.hoverable)t.hoverable=!0;var i,r=t.namespace||X(),l=!1,h={},d=function(e,t,n){var i=e.nodeName.toLowerCase();if("defs"===i)l=!0;var m,p;if(l){var u=D[i];if(u){var c=u(e),f=e.getAttribute("id");if(f)h[f]=c}}else{var u=J[i];if(u){if(p=u(e,n,h),!p)return void W("Unsupported svg node "+i);m=o(e);for(var V in n)if(!m[V])m[V]=n[V];var U=a(e);if(U)p.transform=U,p.decomposeTransform();var f=e.getAttribute("id");if(f)p.id=r+"/"+f;if("group"!==p.type)s(p,m,h);t.addChild(p)}}if(l||"g"===i)for(var y=e.firstChild;y;){if(1===y.nodeType)d(y,p,m);y=y.nextSibling}if("defs"===i)l=!1};if("string"==typeof e){var m=n(e);if(!m)return;for(var i=m.firstChild;i&&("svg"!==i.nodeName.toLowerCase()||1!==i.nodeType);)i=i.nextSibling}else var i=e;if(i){for(var p=new I,u=i.firstChild;u;)d(u,p,{}),u=u.nextSibling;return p.traverse(function(e){if("group"!==e.type)e.hoverable=t.hoverable,e.clickable=t.clickable,e.draggable=t.draggable}),p}}function a(t){var n=t.getAttribute("transform");if(n){var i=w.create(),a=[];n.replace(M,function(e,t,n){a.push(t,n)});for(var r=a.length-1;r>0;r-=2){var o=a[r];o=e(o).replace(/,/g," ").split(/\s+/);var s=a[r-1];switch(s){case"translate":w.translate(i,i,[+o[0],+(o[1]||o[0])]);break;case"scale":w.scale(i,i,[+o[0],+(o[1]||o[0])]);break;case"rotate":w.rotate(i,i,+o[0]);break;case"skew":break;case"matrix":i[0]=+o[0],i[1]=+o[1],i[2]=+o[2],i[3]=+o[3],i[4]=+o[4],i[5]=+o[5]}}return i}}function r(e){var t=e.getAttribute("style");if(t){var n={};return t=t.replace(/\s*([;:])\s*/g,"$1"),t.replace(T,function(e,t,i){n[t]=i}),n}return{}}function o(e){for(var t={},n=0;n<C.length;n++){var i=C[n],a=e.getAttribute(i);if(a)t[i]=a}var o=r(e);for(var s in o)t[s]=o[s];return t}function s(e,t,n){var i="fill",a=l(t.fill,n),r=l(t.stroke,n);if(a)e.style.color=a,i="fill";if(r){if(e.style.strokeColor=r,a)i="both";else i="stroke";e.style.lineWidth=+(t["stroke-width"]||1)}t.opacity&&(e.style.opacity=+t.opacity),t["stroke-linecap"]&&(e.style.lineCap=+t["stroke-linecap"]),t["stroke-linejoin"]&&(e.style.lineJoin=+t["stroke-linejoin"]),t["stroke-miterlimit"]&&(e.style.miterLimit=+t["stroke-miterlimit"]),e.style.brushType=i}function l(e,t){if("none"!==e){var n=S.exec(e);if(n){var i=n[1].trim(),a=t[i];return a}return e}}function h(t){for(var n=e(t).replace(/,/g," ").split(/\s+/),i=[],a=0;a<n.length;){var r=+n[a++],o=+n[a++];i.push([r,o])}return i}function d(e,t){for(var n=e.firstChild;n;){if(1===n.nodeType){var i=n.getAttribute("offset");if(i.indexOf("%")>0)i=parseInt(i)/100;else if(i)i=parseFloat(i);else i=0;var a=n.getAttribute("stop-color")||"#000000";t.addColorStop(i,a)}n=n.nextSibling}}function m(e){for(var t=e.firstChild;t&&"tspan"!==t.nodeName.toLowerCase();)t=t.nextSibling;return!!t}function p(e,t){return u(e,0,0,t)}function u(e,t,n,i,a){var r=e.getAttribute("x"),l=e.getAttribute("y"),h=+e.getAttribute("dx")||0,d=+e.getAttribute("dy")||0;if(!r)r=t+h;else r=+(r||0);if(!l)l=n+d;else l=+(l||0);var p=o(e);for(var V in i)if(!p[V])p[V]=i[V];if(m(e)){var U=new I;U.rect={};var y=e.firstChild;for(U.rect.width=h,U.rect.x=r,U.rect.y=l;y;){if(3===y.nodeType){var g=c(y.textContent||y.nodeValue);if(g){var b=new L({style:{x:r,y:l,text:g,textFont:f(p)}});s(b,p,a);var _=b.getRect(b.style).width;r+=_,U.rect.width+=_,U.addChild(b)}}else if(1===y.nodeType&&"tspan"==y.nodeName.toLowerCase()){var k=u(y,r,l,p);l=k.rect.y,r+=k.rect.width,U.rect.width+=k.rect.width,U.addChild(k)}y=y.nextSibling}return U}else{for(var x="",y=e.firstChild;y;){if(3===y.nodeType)x+=y.textContent||y.nodeValue;y=y.nextSibling}var b=new L({style:{x:r,y:l,text:c(x),textFont:f(p)}});return s(b,p,a),b.rect={width:h+b.getRect(b.style).width,x:r,y:l},r+=b.getRect(b.style).width,b}}function c(t){return e(t.replace(/\n/g," ").replace(/\s+/g," "))}function f(e){var t=[];if(e["font-style"])t.push(e["font-style"]);if(e["font-weight"])t.push(e["font-weight"]);if(e["font-size"])t.push(+e["font-size"]+"px");if(e["font-family"])t.push(e["font-family"]);return t.join(" ")}var V=require("zrender/tool/http"),U=require("zrender/shape/Circle"),y=require("zrender/shape/Ellipse"),g=require("zrender/shape/Rectangle"),b=require("zrender/shape/Line"),_=require("zrender/shape/Path"),k=require("zrender/shape/Polygon"),L=require("zrender/shape/Text"),x=require("zrender/shape/Image"),v=require("zrender/shape/BrokenLine"),w=require("zrender/tool/matrix"),W=(require("zrender/tool/vector"),require("zrender/tool/log")),X=require("zrender/tool/guid"),I=require("zrender/Group"),K=require("zrender/tool/util"),M=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.,]*)\)/g,C=["fill","stroke","stroke-width","opacity","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","font-style","font-weight","font-size","font-family"],T=/(\S*?):(.*?);/g,S=/url\(\s*#(.*?)\)/,D={lineargradient:function(e){var t=+(e.getAttribute("x1")||0),n=+(e.getAttribute("y1")||0),i=+(e.getAttribute("x2")||10),a=+(e.getAttribute("y2")||0),r=K.getContext().createLinearGradient(t,n,i,a);return d(e,r),r},radialgradient:function(){}},J={g:function(){var e=new I;return e},rect:function(e){var t=+(e.getAttribute("x")||0),n=+(e.getAttribute("y")||0),i=+(e.getAttribute("width")||0),a=+(e.getAttribute("height")||0);return new g({style:{x:t,y:n,width:i,height:a}})},circle:function(e){var t=+(e.getAttribute("cx")||0),n=+(e.getAttribute("cy")||0),i=+(e.getAttribute("r")||0);return new U({style:{x:t,y:n,r:i}})},line:function(e){var t=+(e.getAttribute("x1")||0),n=+(e.getAttribute("y1")||0),i=+(e.getAttribute("x2")||0),a=+(e.getAttribute("y2")||0);return new b({style:{xStart:t,yStart:n,xEnd:i,yEnd:a}})},ellipse:function(e){var t=+(e.getAttribute("cx")||0),n=+(e.getAttribute("cy")||0),i=+(e.getAttribute("rx")||0),a=+(e.getAttribute("ry")||0);return new y({style:{x:t,y:n,a:i,b:a}})},polygon:function(e){var t=e.getAttribute("points");if(t){var n=h(t);return new k({style:{pointList:n}})}},polyline:function(e){var t=e.getAttribute("points");if(t){var n=h(t);return new v({style:{pointList:n}})}},path:function(e){var t=e.getAttribute("d");if(t)return new _({style:{path:t}});else return void 0},text:function(e,t,n){return p(e,t,n)},image:function(e){var t=+(e.getAttribute("x")||0),n=+(e.getAttribute("y")||0),i=+(e.getAttribute("width")||0),a=+(e.getAttribute("height")||0),r=e.getAttribute("xlink:href");if(r)return new x({style:{image:r,x:t,y:n,width:i,height:a}});else return void 0}};return{parse:i,load:t}});