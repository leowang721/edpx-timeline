/*! @2014 Leo Wang. All Rights Reserved */
define("zrender/shape/Path",["require","./Base","./util/PathProxy","../tool/util"],function(require){var e=require("./Base"),t=require("./util/PathProxy"),i=t.PathSegment,n=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},a=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(n(e)*n(t))},r=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(a(e,t))},o=function(t){e.call(this,t)};return o.prototype={type:"path",buildPathArray:function(e,t,n){if(!e)return[];t=t||0,n=n||0;var a=e,r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];a=a.replace(/-/g," -"),a=a.replace(/  /g," "),a=a.replace(/ /g,","),a=a.replace(/,,/g,",");var o;for(o=0;o<r.length;o++)a=a.replace(new RegExp(r[o],"g"),"|"+r[o]);var s=a.split("|"),l=[],h=0,d=0;for(o=1;o<s.length;o++){var m=s[o],u=m.charAt(0);m=m.slice(1),m=m.replace(new RegExp("e,-","g"),"e-");var c=m.split(",");if(c.length>0&&""===c[0])c.shift();for(var p=0;p<c.length;p++)c[p]=parseFloat(c[p]);for(;c.length>0&&!isNaN(c[0]);){var f,V,U,y,g,_,b,k,x=null,L=[],v=h,w=d;switch(u){case"l":h+=c.shift(),d+=c.shift(),x="L",L.push(h,d);break;case"L":h=c.shift(),d=c.shift(),L.push(h,d);break;case"m":h+=c.shift(),d+=c.shift(),x="M",L.push(h,d),u="l";break;case"M":h=c.shift(),d=c.shift(),x="M",L.push(h,d),u="L";break;case"h":h+=c.shift(),x="L",L.push(h,d);break;case"H":h=c.shift(),x="L",L.push(h,d);break;case"v":d+=c.shift(),x="L",L.push(h,d);break;case"V":d=c.shift(),x="L",L.push(h,d);break;case"C":L.push(c.shift(),c.shift(),c.shift(),c.shift()),h=c.shift(),d=c.shift(),L.push(h,d);break;case"c":L.push(h+c.shift(),d+c.shift(),h+c.shift(),d+c.shift()),h+=c.shift(),d+=c.shift(),x="C",L.push(h,d);break;case"S":if(f=h,V=d,U=l[l.length-1],"C"===U.command)f=h+(h-U.points[2]),V=d+(d-U.points[3]);L.push(f,V,c.shift(),c.shift()),h=c.shift(),d=c.shift(),x="C",L.push(h,d);break;case"s":if(f=h,V=d,U=l[l.length-1],"C"===U.command)f=h+(h-U.points[2]),V=d+(d-U.points[3]);L.push(f,V,h+c.shift(),d+c.shift()),h+=c.shift(),d+=c.shift(),x="C",L.push(h,d);break;case"Q":L.push(c.shift(),c.shift()),h=c.shift(),d=c.shift(),L.push(h,d);break;case"q":L.push(h+c.shift(),d+c.shift()),h+=c.shift(),d+=c.shift(),x="Q",L.push(h,d);break;case"T":if(f=h,V=d,U=l[l.length-1],"Q"===U.command)f=h+(h-U.points[0]),V=d+(d-U.points[1]);h=c.shift(),d=c.shift(),x="Q",L.push(f,V,h,d);break;case"t":if(f=h,V=d,U=l[l.length-1],"Q"===U.command)f=h+(h-U.points[0]),V=d+(d-U.points[1]);h+=c.shift(),d+=c.shift(),x="Q",L.push(f,V,h,d);break;case"A":y=c.shift(),g=c.shift(),_=c.shift(),b=c.shift(),k=c.shift(),v=h,w=d,h=c.shift(),d=c.shift(),x="A",L=this._convertPoint(v,w,h,d,b,k,y,g,_);break;case"a":y=c.shift(),g=c.shift(),_=c.shift(),b=c.shift(),k=c.shift(),v=h,w=d,h+=c.shift(),d+=c.shift(),x="A",L=this._convertPoint(v,w,h,d,b,k,y,g,_)}for(var W=0,X=L.length;X>W;W+=2)L[W]+=t,L[W+1]+=n;l.push(new i(x||u,L))}if("z"===u||"Z"===u)l.push(new i("z",[]))}return l},_convertPoint:function(e,t,i,n,o,s,l,h,d){var m=d*(Math.PI/180),u=Math.cos(m)*(e-i)/2+Math.sin(m)*(t-n)/2,c=-1*Math.sin(m)*(e-i)/2+Math.cos(m)*(t-n)/2,p=u*u/(l*l)+c*c/(h*h);if(p>1)l*=Math.sqrt(p),h*=Math.sqrt(p);var f=Math.sqrt((l*l*h*h-l*l*c*c-h*h*u*u)/(l*l*c*c+h*h*u*u));if(o===s)f*=-1;if(isNaN(f))f=0;var V=f*l*c/h,U=f*-h*u/l,y=(e+i)/2+Math.cos(m)*V-Math.sin(m)*U,g=(t+n)/2+Math.sin(m)*V+Math.cos(m)*U,_=r([1,0],[(u-V)/l,(c-U)/h]),b=[(u-V)/l,(c-U)/h],k=[(-1*u-V)/l,(-1*c-U)/h],x=r(b,k);if(a(b,k)<=-1)x=Math.PI;if(a(b,k)>=1)x=0;if(0===s&&x>0)x-=2*Math.PI;if(1===s&&0>x)x+=2*Math.PI;return[y,g,l,h,_,x,m,s]},buildPath:function(e,t){var i=t.path,n=t.x||0,a=t.y||0;t.pathArray=t.pathArray||this.buildPathArray(i,n,a);for(var r=t.pathArray,o=t.pointList=[],s=[],l=0,h=r.length;h>l;l++){if("M"==r[l].command.toUpperCase())s.length>0&&o.push(s),s=[];for(var d=r[l].points,m=0,u=d.length;u>m;m+=2)s.push([d[m],d[m+1]])}s.length>0&&o.push(s);for(var l=0,h=r.length;h>l;l++){var c=r[l].command,d=r[l].points;switch(c){case"L":e.lineTo(d[0],d[1]);break;case"M":e.moveTo(d[0],d[1]);break;case"C":e.bezierCurveTo(d[0],d[1],d[2],d[3],d[4],d[5]);break;case"Q":e.quadraticCurveTo(d[0],d[1],d[2],d[3]);break;case"A":var p=d[0],f=d[1],V=d[2],U=d[3],y=d[4],g=d[5],_=d[6],b=d[7],k=V>U?V:U,x=V>U?1:V/U,L=V>U?U/V:1;e.translate(p,f),e.rotate(_),e.scale(x,L),e.arc(0,0,k,y,y+g,1-b),e.scale(1/x,1/L),e.rotate(-_),e.translate(-p,-f);break;case"z":e.closePath()}}},getRect:function(e){if(e.__rect)return e.__rect;var t;if("stroke"==e.brushType||"fill"==e.brushType)t=e.lineWidth||1;else t=0;for(var i=Number.MAX_VALUE,n=Number.MIN_VALUE,a=Number.MAX_VALUE,r=Number.MIN_VALUE,o=e.x||0,s=e.y||0,l=e.pathArray||this.buildPathArray(e.path),h=0;h<l.length;h++)for(var d=l[h].points,m=0;m<d.length;m++)if(m%2===0){if(d[m]+o<i)i=d[m];if(d[m]+o>n)n=d[m]}else{if(d[m]+s<a)a=d[m];if(d[m]+s>r)r=d[m]}var u;if(i===Number.MAX_VALUE||n===Number.MIN_VALUE||a===Number.MAX_VALUE||r===Number.MIN_VALUE)u={x:0,y:0,width:0,height:0};else u={x:Math.round(i-t/2),y:Math.round(a-t/2),width:n-i+t,height:r-a+t};return e.__rect=u,u}},require("../tool/util").inherits(o,e),o});