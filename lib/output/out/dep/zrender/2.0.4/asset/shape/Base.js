/*! @2014 Leo Wang. All Rights Reserved */
define("zrender/shape/Base",["require","../tool/matrix","../tool/guid","../tool/util","../tool/log","../mixin/Transformable","../mixin/Eventful","../tool/area","../tool/color"],function(require){function e(e,n,i,a,r,o,s){if(r)e.font=r;e.textAlign=o,e.textBaseline=s;var l=t(n,i,a,r,o,s);n=(n+"").split("\n");var h=require("../tool/area").getTextHeight("国",r);switch(s){case"top":a=l.y;break;case"bottom":a=l.y+h;break;default:a=l.y+h/2}for(var d=0,m=n.length;m>d;d++)e.fillText(n[d],i,a),a+=h}function t(e,t,n,i,a,r){var o=require("../tool/area"),s=o.getTextWidth(e,i),l=o.getTextHeight("国",i);switch(e=(e+"").split("\n"),a){case"end":case"right":t-=s;break;case"center":t-=s/2}switch(r){case"top":break;case"bottom":n-=l*e.length;break;default:n-=l*e.length/2}return{x:t,y:n,width:s,height:l*e.length}}var n=require("../tool/matrix"),i=require("../tool/guid"),a=require("../tool/util"),r=require("../tool/log"),o=require("../mixin/Transformable"),s=require("../mixin/Eventful"),l=function(e){e=e||{},this.id=e.id||i();for(var t in e)this[t]=e[t];this.style=this.style||{},this.highlightStyle=this.highlightStyle||null,this.parent=null,this.__dirty=!0,o.call(this),s.call(this)};l.prototype.invisible=!1,l.prototype.ignore=!1,l.prototype.zlevel=0,l.prototype.draggable=!1,l.prototype.clickable=!1,l.prototype.hoverable=!0,l.prototype.z=0,l.prototype.brush=function(e,t){var n=this.style;if(this.brushTypeOnly)n.brushType=this.brushTypeOnly;if(t)n=this.getHighlightStyle(n,this.highlightStyle||{},this.brushTypeOnly);if("stroke"==this.brushTypeOnly)n.strokeColor=n.strokeColor||n.color;switch(e.save(),this.setContext(e,n),this.setTransform(e),e.beginPath(),this.buildPath(e,n),n.brushType){case"both":e.fill();case"stroke":n.lineWidth>0&&e.stroke();break;default:e.fill()}this.drawText(e,n,this.style),e.restore()};var h=[["color","fillStyle"],["strokeColor","strokeStyle"],["opacity","globalAlpha"],["lineCap","lineCap"],["lineJoin","lineJoin"],["miterLimit","miterLimit"],["lineWidth","lineWidth"],["shadowBlur","shadowBlur"],["shadowColor","shadowColor"],["shadowOffsetX","shadowOffsetX"],["shadowOffsetY","shadowOffsetY"]];return l.prototype.setContext=function(e,t){for(var n=0,i=h.length;i>n;n++){var a=h[n][0],r=t[a],o=h[n][1];if("undefined"!=typeof r)e[o]=r}},l.prototype.getHighlightStyle=function(e,t,n){var i={};for(var a in e)i[a]=e[a];var r=require("../tool/color"),o=r.getHighlightColor();if("stroke"!=e.brushType)i.strokeColor=o,i.lineWidth=(e.lineWidth||1)+this.getHighlightZoom(),i.brushType="both";else if("stroke"!=n)i.strokeColor=o,i.lineWidth=(e.lineWidth||1)+this.getHighlightZoom();else i.strokeColor=t.strokeColor||r.mix(e.strokeColor,r.toRGB(o));for(var a in t)if("undefined"!=typeof t[a])i[a]=t[a];return i},l.prototype.getHighlightZoom=function(){return"text"!=this.type?6:2},l.prototype.drift=function(e,t){this.position[0]+=e,this.position[1]+=t},l.prototype.getTansform=function(){var e=[];return function(t,i){var a=[t,i];if(this.needTransform&&this.transform)if(n.invert(e,this.transform),n.mulVector(a,e,[t,i,1]),t==a[0]&&i==a[1])this.updateNeedTransform();return a}}(),l.prototype.buildPath=function(){r("buildPath not implemented in "+this.type)},l.prototype.getRect=function(){r("getRect not implemented in "+this.type)},l.prototype.isCover=function(e,t){var n=this.getTansform(e,t);e=n[0],t=n[1];var i=this.style.__rect;if(!i)i=this.style.__rect=this.getRect(this.style);if(e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height)return require("../tool/area").isInside(this,this.style,e,t);else return!1},l.prototype.drawText=function(t,n,i){if("undefined"!=typeof n.text&&n.text!==!1){var a=n.textColor||n.color||n.strokeColor;t.fillStyle=a;var r,o,s,l,h=10,d=n.textPosition||this.textPosition||"top";switch(d){case"inside":case"top":case"bottom":case"left":case"right":if(this.getRect){var m=(i||n).__rect||this.getRect(i||n);switch(d){case"inside":if(s=m.x+m.width/2,l=m.y+m.height/2,r="center",o="middle","stroke"!=n.brushType&&a==n.color)t.fillStyle="#fff";break;case"left":s=m.x-h,l=m.y+m.height/2,r="end",o="middle";break;case"right":s=m.x+m.width+h,l=m.y+m.height/2,r="start",o="middle";break;case"top":s=m.x+m.width/2,l=m.y-h,r="center",o="bottom";break;case"bottom":s=m.x+m.width/2,l=m.y+m.height+h,r="center",o="top"}}break;case"start":case"end":var u,c,p,f;if("undefined"!=typeof n.pointList){var V=n.pointList;if(V.length<2)return;var U=V.length;switch(d){case"start":u=V[0][0],c=V[1][0],p=V[0][1],f=V[1][1];break;case"end":u=V[U-2][0],c=V[U-1][0],p=V[U-2][1],f=V[U-1][1]}}else u=n.xStart||0,c=n.xEnd||0,p=n.yStart||0,f=n.yEnd||0;switch(d){case"start":r=c>u?"end":"start",o=f>p?"bottom":"top",s=u,l=p;break;case"end":r=c>u?"start":"end",o=f>p?"top":"bottom",s=c,l=f}if(h-=4,u!=c)s-="end"==r?h:-h;else r="center";if(p!=f)l-="bottom"==o?h:-h;else o="middle";break;case"specific":s=n.textX||0,l=n.textY||0,r="start",o="middle"}if(null!=s&&null!=l)e(t,n.text,s,l,n.textFont,n.textAlign||r,n.textBaseline||o)}},l.prototype.modSelf=function(){if(this.__dirty=!0,this.style)this.style.__rect=null},l.prototype.isSilent=function(){return!(this.hoverable||this.draggable||this.clickable||this.onmousemove||this.onmouseover||this.onmouseout||this.onmousedown||this.onmouseup||this.onclick||this.ondragenter||this.ondragover||this.ondragleave||this.ondrop)},a.merge(l.prototype,o.prototype,!0),a.merge(l.prototype,s.prototype,!0),l});