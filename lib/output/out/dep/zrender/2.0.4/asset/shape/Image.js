/*! @2014 Leo Wang. All Rights Reserved */
define("zrender/shape/Image",["require","./Base","../tool/util"],function(require){var e,t=[],i=require("./Base"),n=function(e){i.call(this,e),this._imageCache={}};return n.prototype={type:"image",brush:function(i,n,a){var r=this.style||{};if(n)r=this.getHighlightStyle(r,this.highlightStyle||{});var o=r.image,s=this;if("string"==typeof o){var l=o;if(this._imageCache[l])o=this._imageCache[l];else o=new Image,o.onload=function(){o.onload=null,clearTimeout(e),t.push(s),e=setTimeout(function(){a&&a(t),t=[]},10)},o.src=l,this._imageCache[l]=o}if(o){if("IMG"==o.nodeName.toUpperCase())if(window.ActiveXObject){if("complete"!=o.readyState)return}else if(!o.complete)return;var h=r.width||o.width,d=r.height||o.height,m=r.x,u=r.y;if(!o.width||!o.height)return;if(i.save(),this.setContext(i,r),this.setTransform(i),r.sWidth&&r.sHeight){var c=r.sx||0,p=r.sy||0;i.drawImage(o,c,p,r.sWidth,r.sHeight,m,u,h,d)}else if(r.sx&&r.sy){var c=r.sx,p=r.sy,f=h-c,V=d-p;i.drawImage(o,c,p,f,V,m,u,h,d)}else i.drawImage(o,m,u,h,d);if(!r.width)r.width=h;if(!r.height)r.height=d;if(!this.style.width)this.style.width=h;if(!this.style.height)this.style.height=d;this.drawText(i,r,this.style),i.restore()}},getRect:function(e){return{x:e.x,y:e.y,width:e.width,height:e.height}},clearCache:function(){this._imageCache={}}},require("../tool/util").inherits(n,i),n});