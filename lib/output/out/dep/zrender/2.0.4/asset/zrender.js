/*! @2014 Leo Wang. All Rights Reserved */
define("zrender/zrender",["require","./dep/excanvas","./tool/util","./tool/log","./tool/guid","./Handler","./Painter","./Storage","./animation/Animation","./tool/env"],function(require){function e(e){return function(){for(var t=e.animatingElements,i=0,n=t.length;n>i;i++)e.storage.mod(t[i].id);if(t.length||e._needsRefreshNextFrame)e.refresh()}}require("./dep/excanvas");var t=require("./tool/util"),i=require("./tool/log"),n=require("./tool/guid"),a=require("./Handler"),r=require("./Painter"),o=require("./Storage"),s=require("./animation/Animation"),l={},h={};h.version="2.0.4",h.init=function(e){var t=new d(n(),e);return l[t.id]=t,t},h.dispose=function(e){if(e)e.dispose();else{for(var t in l)l[t].dispose();l={}}return h},h.getInstance=function(e){return l[e]},h.delInstance=function(e){return delete l[e],h};var d=function(t,i){this.id=t,this.env=require("./tool/env"),this.storage=new o,this.painter=new r(i,this.storage),this.handler=new a(i,this.storage,this.painter),this.animatingElements=[],this.animation=new s({stage:{update:e(this)}}),this.animation.start(),this._needsRefreshNextFrame=!1};return d.prototype.getId=function(){return this.id},d.prototype.addShape=function(e){return this.storage.addRoot(e),this},d.prototype.addGroup=function(e){return this.storage.addRoot(e),this},d.prototype.delShape=function(e){return this.storage.delRoot(e),this},d.prototype.delGroup=function(e){return this.storage.delRoot(e),this},d.prototype.modShape=function(e,t){return this.storage.mod(e,t),this},d.prototype.modGroup=function(e,t){return this.storage.mod(e,t),this},d.prototype.modLayer=function(e,t){return this.painter.modLayer(e,t),this},d.prototype.addHoverShape=function(e){return this.storage.addHover(e),this},d.prototype.render=function(e){return this.painter.render(e),this._needsRefreshNextFrame=!1,this},d.prototype.refresh=function(e){return this.painter.refresh(e),this._needsRefreshNextFrame=!1,this},d.prototype.refreshNextFrame=function(){return this._needsRefreshNextFrame=!0,this},d.prototype.refreshHover=function(e){return this.painter.refreshHover(e),this},d.prototype.refreshShapes=function(e,t){return this.painter.refreshShapes(e,t),this},d.prototype.resize=function(){return this.painter.resize(),this},d.prototype.animate=function(e,n,a){if("string"==typeof e)e=this.storage.get(e);if(e){var r;if(n){for(var o=n.split("."),s=e,l=0,h=o.length;h>l;l++)if(s)s=s[o[l]];else;if(s)r=s}else r=e;if(!r)return void i('Property "'+n+'" is not existed in element '+e.id);var d=this.animatingElements;if("undefined"==typeof e.__aniCount)e.__aniCount=0;if(0===e.__aniCount)d.push(e);return e.__aniCount++,this.animation.animate(r,{loop:a}).done(function(){if(e.__aniCount--,0===e.__aniCount){var i=t.indexOf(d,e);d.splice(i,1)}})}else i("Element not existed")},d.prototype.clearAnimation=function(){this.animation.clear()},d.prototype.showLoading=function(e){return this.painter.showLoading(e),this},d.prototype.hideLoading=function(){return this.painter.hideLoading(),this},d.prototype.getWidth=function(){return this.painter.getWidth()},d.prototype.getHeight=function(){return this.painter.getHeight()},d.prototype.toDataURL=function(e,t,i){return this.painter.toDataURL(e,t,i)},d.prototype.shapeToImage=function(e,t,i){var a=n();return this.painter.shapeToImage(a,e,t,i)},d.prototype.on=function(e,t){return this.handler.on(e,t),this},d.prototype.un=function(e,t){return this.handler.un(e,t),this},d.prototype.trigger=function(e,t){return this.handler.trigger(e,t),this},d.prototype.clear=function(){return this.storage.delRoot(),this.painter.clear(),this},d.prototype.dispose=function(){this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.animatingElements=this.storage=this.painter=this.handler=null,h.delInstance(this.id)},h}),define("zrender",["zrender/zrender"],function(e){return e});