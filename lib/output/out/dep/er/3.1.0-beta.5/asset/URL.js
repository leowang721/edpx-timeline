/*! @2014 Leo Wang. All Rights Reserved */
define("er/URL",["require","./util","eoo"],function(require){var e=require("./util"),exports={};exports.constructor=function(n,i,a){n=n||"/",i=i||"",a=a||"~",this.toString=function(){return i?n+a+i:n},this.getPath=function(){return n},this.getSearch=function(){return i};var o=null;this.getQuery=function(n){if(!o)o=t.parseQuery(i);return n?o[n]:e.mix({},o)}},exports.compare=function(e){if("string"==typeof e)e=t.parse(e);var n={},i=this.getPath(),a=e.getPath();if(i===a)n.path=!1;else n.path={key:"path",self:i,other:a};var o=this.getQuery(),s=e.getQuery(),r={},l=[],h=!1;for(var V in o)if(o.hasOwnProperty(V)){var U=o[V],m=s[V];if(U!==m){h=!0;var p={key:V,self:U,other:m};l.push(p),r[V]=p}}for(var V in s)if(s.hasOwnProperty(V)&&!o.hasOwnProperty(V)){h=!0;var p={key:V,self:void 0,other:s[V]};l.push(p),r[V]=p}return n.queryDifference=l,n.query=h?r:!1,n};var t=require("eoo").create(exports);return t.parse=function(n,i){var a={querySeparator:"~"};i=e.mix(a,i);var o=n.indexOf(i.querySeparator);if(o>=0)return new t(n.slice(0,o),n.slice(o+1),i.querySeparator);else return new t(n,"",i.querySeparator)},t.withQuery=function(n,i,a){n+="";var o={querySeparator:"~"};a=e.mix(o,a);var s=n.indexOf(a.querySeparator)<0?a.querySeparator:"&",r=t.serialize(i),l=n+s+r;return t.parse(l,a)},t.parseQuery=function(e){for(var t=e.split("&"),n={},i=0;i<t.length;i++){var a=t[i];if(a){var o=a.indexOf("="),s=0>o?decodeURIComponent(a):decodeURIComponent(a.slice(0,o)),r=0>o?!0:decodeURIComponent(a.slice(o+1));if(n.hasOwnProperty(s)){if(r!==!0)n[s]=[].concat(n[s],r)}else n[s]=r}else;}return n},t.serialize=function(e){if(!e)return"";var t="";for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(i)}return t.slice(1)},t.empty=new t,t});