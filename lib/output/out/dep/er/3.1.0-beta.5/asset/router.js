/*! @2014 Leo Wang. All Rights Reserved */
define("er/router",["require","./URL","eoo","mini-event/EventTarget","./locator","./events"],function(require){function e(e){for(var t=require("./URL").parse(e.url),n=t.getPath(),i=0;i<this.routes.length;i++){var a=this.routes[i];if(a.rule instanceof RegExp&&a.rule.test(n)||a.rule===n)return void a.handler.call(this,t)}if(this.backup)this.backup(t);this.getEventBus().fire("route",{url:t,router:this})}var exports={};exports.constructor=function(){this.routes=[],this.backup=null},exports.add=function(e,t){this.routes.push({rule:e,handler:t})},exports.setBackup=function(e){this.backup=e},exports.getLocator=function(){return this.locator},exports.setLocator=function(e){this.locator=e},exports.getEventBus=function(){return this.eventBus},exports.setEventBus=function(e){this.eventBus=e},exports.start=function(){this.getLocator().on("redirect",e,this)};var t=require("eoo").create(require("mini-event/EventTarget"),exports),n=new t;return n.setLocator(require("./locator")),n.setEventBus(require("./events")),n.Router=t,n});