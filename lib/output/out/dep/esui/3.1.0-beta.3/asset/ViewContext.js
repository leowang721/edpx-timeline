/*! @2014 Leo Wang. All Rights Reserved */
define("esui/ViewContext",["require","./ControlCollection","./lib","./SafeWrapper"],function(require){function e(e){r.apply(this,arguments),this.name=e}function t(e,t){r.prototype.add.call(t,e)}function i(e,t){r.prototype.remove.call(t,e)}function n(e){var t=e.get("group");return t?t.split(/[\t\r\n ]/):[]}function a(){return"vt"+s++}function o(e){if(this.controls={},this.groups={},e=e||a(),l.hasOwnProperty(e)){for(var t=1,i=e+"-";l.hasOwnProperty(i+t);)t++;e=i+t}this.id=e,l[this.id]=this}var r=require("./ControlCollection");require("./lib").inherits(e,r),e.prototype.add=void 0,e.prototype.remove=void 0,e.prototype.disposeGroup=function(){for(var e=0;e<this.length;e++)delete this[e];this.length=0};var s=8587523,l={};o.get=function(e){return l[e]||null},o.prototype.add=function(e){var i=this.controls[e.id];if(i){if(i===e)return;i.setViewContext(null)}this.controls[e.id]=e;for(var a=n(e),o=0;o<a.length;o++){var r=a[o];if(r){var s=this.getGroup(r);t(e,s)}else;}e.setViewContext(this)},o.prototype.remove=function(e){delete this.controls[e.id];for(var t=n(e),a=0;a<t.length;a++){var o=t[a];if(o){var r=this.getGroup(o);i(e,r)}else;}e.setViewContext(null)},o.prototype.get=function(e){return this.controls[e]};var h=require("./SafeWrapper");return o.prototype.getSafely=function(e){var t=this.get(e);if(!t)t=new h,t.id=e,t.viewContext=this;return t},o.prototype.getGroup=function(t){if(!t)throw new Error("name is unspecified");var i=this.groups[t];if(!i)i=this.groups[t]=new e(t);return i},o.prototype.clean=function(){for(var e in this.controls)if(this.controls.hasOwnProperty(e)){var t=this.controls[e];if(t.dispose(),t.viewContext&&t.viewContext===this)this.remove(t)}for(var i in this.groups)if(this.groups.hasOwnProperty(i))this.groups[i].disposeGroup(),this.groups[i]=void 0},o.prototype.dispose=function(){this.clean(),delete l[this.id]},o});