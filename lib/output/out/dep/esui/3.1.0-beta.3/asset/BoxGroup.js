/*! @2014 Leo Wang. All Rights Reserved */
define("esui/BoxGroup",["require","underscore","./lib","./InputControl","./painters","./main"],function(require){function e(){s.apply(this,arguments)}function t(e,t){for(var n=e.getElementsByTagName("input"),i=e.getElementsByTagName("label"),a={},s=i.length-1;s>=0;s--){var r=i[s],l=o.getAttribute(r,"for");if(l)a[l]=r}for(var h=[],V=[],s=0,U=n.length;U>s;s++){var m=n[s];if(m.type===t.boxType&&(t.name||"")===m.name){var p={value:m.value},r=m.id&&a[m.id];if(p.title=r?o.getText(r):"",!p.title)p.title=m.title||("on"===m.value?m.value:"");if(h.push(p),null!==m.getAttribute("checked"))V.push(m.value)}}if(t.datasource=h,!t.rawValue&&!t.value)t.rawValue=V}function n(){var e=a.chain(this.getBoxElements()).where({checked:!0}).pluck("value").value();this.rawValue=e,this.fire("change")}function i(e,t,i){e.helper.clearDOMEvents();for(var s="",l=[].concat(e.helper.getPartClasses(i),e.helper.getPartClasses("wrapper")),h=o.toDictionary(e.rawValue),V=e.name||o.getGUID(),U=0;U<t.length;U++){var m=t[U],p={wrapperClass:l.join(" "),id:e.helper.getId("box-"+U),type:e.boxType,name:V,title:o.trim(m.title||m.name||m.text),value:m.value,checked:h[m.value]?' checked="checked"':""};s+=o.format(r,p)}e.main.innerHTML=s;var d=e.main.addEventListener?"change":"click";a.each(e.getBoxElements(),function(e){this.helper.addDOMEvent(e,d,n)},e)}var a=require("underscore"),o=require("./lib"),s=require("./InputControl");e.prototype.type="BoxGroup",e.prototype.initOptions=function(e){var n={datasource:[],orientation:"horizontal",boxType:"radio"};if(a.extend(n,e),!n.datasource.length)t(this.main,n);if(!n.rawValue&&!n.value)n.rawValue=[];this.setProperties(n)};var r=['<label title="${title}" class="${wrapperClass}">','<input type="${type}" name="${name}" id="${id}" title="${title}" value="${value}"${checked} />',"<span>${title}</span>","</label>"];return r=r.join(""),e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=s.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.repaint=require("./painters").createRepaint(s.prototype.repaint,{name:["datasource","boxType"],paint:i},{name:["disabled","readOnly"],paint:function(e,t,n){a.each(e.getBoxElements(),function(e){e.disabled=t,e.readOnly=n})}},{name:"rawValue",paint:function(e,t){t=t||[],e.rawValue=t;for(var n={},i=0;i<t.length;i++)n[t[i]]=!0;a.each(e.getBoxElements(),function(e){e.checked=n.hasOwnProperty(e.value)})}},{name:"orientation",paint:function(e,t){e.removeState("vertical"),e.removeState("horizontal"),e.addState(t)}}),e.prototype.parseValue=function(e){return e.split(",")},e.prototype.getBoxElements=function(){return a.where(this.main.getElementsByTagName("input"),{type:this.boxType})},o.inherits(e,s),require("./main").register(e),e});