/*! @2014 Leo Wang. All Rights Reserved */
define("esui/Wizard",["require","underscore","./lib","./Control","./painters","./main"],function(require){function e(){o.apply(this,arguments)}function t(e,t,i){var n=t&&t.panel&&a.g(t.panel);if(n){var o=i?"removePartClasses":"addPartClasses";e.helper[o]("panel-hidden",n)}}function i(e){for(var i="",n=0;n<e.steps.length;n++){var a=e.steps[n],o=e.helper.getPartClasses("node");if(0===n)o.push.apply(o,e.helper.getPartClasses("node-first"));if(n===e.steps.length-1&&!e.finishText)o.push.apply(o,e.helper.getPartClasses("node-last"));if(n===e.activeIndex-1)o.push.apply(o,e.helper.getPartClasses("node-active-prev"));if(n<=e.activeIndex-1)o.push.apply(o,e.helper.getPartClasses("node-done"));var r=n===e.activeIndex;if(t(e,a,r),r)if(o.push.apply(o,e.helper.getPartClasses("node-active")),n===e.steps.length-1)o.push.apply(o,e.helper.getPartClasses("node-last-active"));i+='<li class="'+o.join(" ")+'">',i+=e.getNodeHTML(a),i+="</li>"}if(e.finishText){var o=[].concat(e.helper.getPartClasses("node"),e.helper.getPartClasses("node-last"),e.helper.getPartClasses("node-finish"),e.activeIndex===e.steps.length?e.helper.getPartClasses("node-active"):[]);i+='<li class="'+o.join(" ")+'">',i+="<span>"+e.finishText+"</span>",i+="</li>"}return i}var n=require("underscore"),a=require("./lib"),o=require("./Control");e.prototype.type="Wizard",e.prototype.createMain=function(){return document.createElement("ol")},e.prototype.initOptions=function(e){var t={steps:[],activeIndex:0},i=a.getChildren(this.main);if(!e.steps&&i.length)t.steps=n.map(i,function(e){var t={text:a.getText(e)},i=e.getAttribute("data-for");if(i)t.panel=i;return t});if(n.extend(t,e),"string"==typeof t.activeIndex)t.activeIndex=+t.activeIndex;this.setProperties(t)},e.prototype.nodeTemplate="<span>${text}</span>",e.prototype.getNodeHTML=function(e){return a.format(this.nodeTemplate,{text:a.encodeHTML(e.text)})};var r=require("./painters");return e.prototype.repaint=r.createRepaint(o.prototype.repaint,{name:["steps","finishText"],paint:function(e){e.main.innerHTML=i(e)}},{name:"activeIndex",paint:function(e){if(e.helper.isInStage("RENDERED"))for(var i=e.main.getElementsByTagName("li"),n=i.length-1;n>=0;n--){var a=n===e.activeIndex;t(e,e.steps[n],a);var o=i[n],r=a?"addPartClasses":"removePartClasses";if(e.helper[r]("node-active",o),n===e.steps.length-1)e.helper[r]("node-last-active",o);var s=n<=e.activeIndex-1,r=s?"addPartClasses":"removePartClasses";e.helper[r]("node-done",o);var l=n===e.activeIndex-1,r=l?"addPartClasses":"removePartClasses";e.helper[r]("node-active-prev",o)}}}),e.prototype.setProperties=function(e){if(e.hasOwnProperty("steps")){if(e.hasOwnProperty("activeIndex"))this.activeIndex=e.activeIndex,delete e.activeIndex;else this.activeIndex=0;if(e.hasOwnProperty("finishText"))this.finishText=e.finishText,delete e.finishText}var t=o.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("steps")||t.hasOwnProperty("activeIndex"))this.fire("enter")},e.prototype.getActiveStep=function(){return this.get("steps")[this.get("activeIndex")]},e.prototype.stepNext=function(){var e=this.finishText?this.steps.length:this.steps.length-1;if(this.activeIndex<e)this.set("activeIndex",this.activeIndex+1)},e.prototype.stepPrevious=function(){if(this.activeIndex>0)this.set("activeIndex",this.activeIndex-1)},require("./main").register(e),a.inherits(e,o),e});