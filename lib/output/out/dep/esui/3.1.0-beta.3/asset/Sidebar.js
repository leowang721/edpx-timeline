/*! @2014 Leo Wang. All Rights Reserved */
define("esui/Sidebar",["require","./lib","./Control","./main","./Panel","./controlHelper","./Button"],function(require){function e(){b.apply(this,arguments)}function t(e){return g.g(L.getId(e,"mat"))}function i(e){return g.g(L.getId(e,"minibar"))}function n(e){var t=g.dom.first(e.main);if(t){g.addClasses(t,L.getPartClasses(e,"head")),e.headEl=t;var i=g.dom.next(t);if(i){e.bodyEl=i,g.addClasses(i,L.getPartClasses(e,"body"));var n=new x({main:i,renderOptions:e.renderOptions});e.addChild(n,"content"),n.render()}}}function a(e){var t=e,i=document.createElement("div"),n=L.getPartClasses(t,"mat");i.id=L.getId(t,"mat"),i.className=n.join(" "),document.body.appendChild(i)}function o(e){var t=e,i=document.createElement("div"),n=[],a=L.getPartClasses(t,"minibar-text");t.headEl&&n.push('<div class="'+a.join(" ")+'">'+t.headEl.innerHTML+"</div>");var o=L.getPartClasses(t,"minibar-arrow");n.push('<div class="'+o.join(" ")+'"></div>'),i.innerHTML=n.join(""),i.id=L.getId(t,"minibar"),i.className=L.getPartClasses(t,"minibar").join(" "),L.addDOMEvent(t,i,"mouseover",g.bind(U,null,t,i)),L.addDOMEvent(t,i,"mouseout",g.bind(d,null,t,i)),document.body.appendChild(i)}function s(e){var t=e,i=t.main;require("./Button");var n=k.create("Button",{id:L.getId(t,"autohide"),skin:"autohide"}),a=k.create("Button",{id:L.getId(t,"fixed"),skin:"fixed"});n.appendTo(i),a.appendTo(i),t.addChild(n,"btnAutoHide"),t.addChild(a,"btnFixed"),n.onclick=g.curry(c,t),a.onclick=g.curry(p,t)}function r(e){var n=e,a=g.page.getScrollTop(),o=n.marginTop||0,s=Math.max(n.top+o-a,o),r=n.main,l=t(n),h=i(n);r.style.top=s+"px",h.style.top=s+"px",l.style.top=s-o+"px"}function l(e){var t=e,n=t.main;n.style.cssText+=";left: "+(t.marginLeft?t.marginLeft+"px":0)+";bottom:"+(t.marginBottom?t.marginBottom+"px":0)+";";var a=t.bodyEl;a.style.top=t.headHeight?t.headHeight+"px":0;var o=i(t);o.style.bottom=t.marginBottom?t.marginBottom+"px":0,r(t)}function h(e){t(e).style.display="none"}function m(e){if(t(e).style.display="block",e.main.style.display="block",i(e).style.display="none",!e.isAutoHide())h(e)}function V(e){h(e),e.main.style.display="none",i(e).style.display="block"}function U(e,t){var i=e,n=L.getPartClasses(i,"minibar-hover");if(!g.hasClass(t,n[0]))g.addClasses(t,n),i.minibarDisplayTick=setTimeout(function(){m(i)},i.autoDelay)}function d(e,t){var i=e,n=L.getPartClasses(i,"minibar-hover");g.removeClasses(t,n),clearTimeout(i.minibarDisplayTick)}function p(e){e.setMode("fixed")}function c(e){e.setMode("autohide")}function u(e,t){var i=e;if(t=t.toLowerCase(),"fixed"==t)i.getChild("btnAutoHide").show(),i.getChild("btnFixed").hide();else i.getChild("btnAutoHide").hide(),i.getChild("btnFixed").show();i.mode=t}function f(e){clearTimeout(e.minibarDisplayTick)}function y(e,t){var i=e;if(e.isAutoHide()){t=t||window.event;var n=t.relatedTarget||t.toElement;if(!g.dom.contains(e.main,n))i.minibarDisplayTick=setTimeout(function(){V(i)},i.autoDelay)}}var g=require("./lib"),b=require("./Control"),k=require("./main"),x=require("./Panel"),L=require("./controlHelper");return e.prototype.type="Sidebar",e.prototype.createMain=function(e){if(!e.tagName)return b.prototype.createMain.call(this);else return document.createElement(e.tagName)},e.prototype.initOptions=function(e){var t={headHeight:37,marginTop:10,marginLeft:10,marginBottom:10,autoDelay:300,mode:"fixed"};g.extend(t,e);var i=this.main,n=i.parentNode,a=g.getOffset(n),o=g.getOffset(i);if(null==this.initialOffsetTop)this.initialOffsetTop=o.top-a.top,t.top=o.top,t.left=o.left;else t.top=a.top+this.initialOffsetTop;g.extend(this,t)},e.prototype.initStructure=function(){if(n(this),a(this),o(this),s(this),!g.ie||g.ie>=7)this.topReset=g.curry(r,this),g.on(window,"scroll",this.topReset);if(l(this),this.isAutoHide())V(this)},e.prototype.initEvents=function(){this.helper.addDOMEvent(this.main,"mouseover",g.bind(f,null,this)),this.helper.addDOMEvent(this.main,"mouseout",g.bind(y,null,this))},e.prototype.repaint=L.createRepaint(b.prototype.repaint,{name:"mode",paint:function(e,t){if(u(e,t),e.isAutoHide())V(e);else m(e);if(L.isInStage(e,"RENDERED"))e.fire("modechange",{mode:t})}}),e.prototype.setMode=function(e){this.setProperties({mode:e})},e.prototype.getMode=function(){return this.mode},e.prototype.getPanel=function(){return this.getChild("content")},e.prototype.setContent=function(e){var t=this.getPanel();if(t)t.setProperties({content:e})},e.prototype.isAutoHide=function(){return"autohide"==this.mode},e.prototype.dispose=function(){if(!L.isInStage(this,"DISPOSED")){if(L.beforeDispose(this),this.topReset)g.un(window,"scroll",this.topReset),this.topReseter=null;var e=t(this),n=i(this);document.body.removeChild(n),document.body.removeChild(e),this.headEl=null,this.bodyEl=null,L.dispose(this),L.afterDispose(this)}},g.inherits(e,b),k.register(e),e});