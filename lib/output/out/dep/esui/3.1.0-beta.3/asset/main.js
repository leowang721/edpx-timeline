/*! @2014 Leo Wang. All Rights Reserved */
define("esui/main",["require","./lib","./ViewContext","./ControlCollection"],function(require){function e(e,t){if("function"==typeof e){var i=e.prototype.type;if(i in t)throw new Error(i+" is exists!");t[i]=e}}function t(e,t,i){var n=i[e];if(n)return delete t.type,new n(t);else return null}var i=require("./lib"),n={};n.version="3.1.0-beta.3";var a=require("./ViewContext"),o=new a("default");n.getViewContext=function(){return o};var r={uiPrefix:"data-ui",extensionPrefix:"data-ui-extension",customElementPrefix:"esui",instanceAttr:"data-ctrl-id",viewContextAttr:"data-ctrl-view-context",uiClassPrefix:"ui",skinClassPrefix:"skin",stateClassPrefix:"state"};n.config=function(e){i.extend(r,e)},n.getConfig=function(e){return r[e]},n.parseAttribute=function(e,t){if(!e)return{};for(var n={},a=0,o=0;o<e.length;){for(;o<e.length&&":"!==e.charAt(o);)o++;if(o>=e.length)break;var r=i.trim(e.slice(a,o));for(o++,a=o;o<e.length&&";"!==e.charAt(o);)o++;for(var s=o+1;s<e.length;){var l=e.charAt(s);if(";"===l)o=s;if(":"===l)break;s++}var h=i.trim(e.slice(a,o));n[r]=t?t(h):h,o++,a=o}return n},n.getControlByDOM=function(e){if(!e)return null;var t,i=n.getConfig,o=e.getAttribute(i("instanceAttr")),r=e.getAttribute(i("viewContextAttr"));if(o&&r&&(t=a.get(r)))return t.get(o);else return null};var s={};n.register=function(t){e(t,s)},n.create=function(e,i){return t(e,i,s)},n.get=function(e){return o.get(e)},n.getSafely=function(e){return o.getSafely(e)};var l=require("./ControlCollection");n.wrap=function(){for(var e=new l,t=0;t<arguments.length;t++)e.add(arguments[t]);return e},n.init=function(e,t){function i(e){function t(e){return e.toUpperCase()}for(var i=1,n=e.length;n>i;i++)e[i]=e[i].replace(/^[a-z]/,t);return e.join("")}function a(e,t){for(var i in t)if(!(i in e))e[i]=t[i]}function o(e,t,o){if(0===t.length)a(e,n.parseAttribute(o,s));else e[i(t)]=s(o)}e=e||document.body,t=t||{};for(var s=t.valueReplacer||function(e){return e},l=e.getElementsByTagName("*"),h=[],d=0,m=l.length;m>d;d++)if(1===l[d].nodeType)h.push(l[d]);for(var p=n.getConfig("uiPrefix"),V=n.getConfig("extensionPrefix"),c=n.getConfig("customElementPrefix"),U=p.length,u=V.length,f=t.properties||{},y=[],d=0,m=h.length;m>d;d++){var g=h[d];if(!g.getAttribute(r.instanceAttr)){for(var b=g.attributes,k={},x={},L=0,v=b.length;v>L;L++){var _=b[L],W=_.name,w=_.value;if(0===W.indexOf(V)){var X=W.slice(u+1).split("-"),I=X[0];X.shift();var K=x[I];if(!K)K=x[I]={};o(K,X,w)}else if(0===W.indexOf(p)){var X=W.length==U?[]:W.slice(U+1).split("-");o(k,X,w)}}var C=k.type;if(!C){var J=g.nodeName.toLowerCase(),S=J.indexOf(c);if(0===S){var E=J.replace(/-(\S)/g,function(e,t){return t.toUpperCase()});E=E.slice(c.length),k.type=E,C=E}}if(C){var T=k.id,P=T?f[T]:{};for(var A in P)k[A]=s(P[A]);var O=k.extensions||[];k.extensions=O;for(var A in x){var K=x[A],F=n.createExtension(K.type,K);F&&O.push(F)}k.viewContext=t.viewContext,k.renderOptions=t,k.main=g;var M=n.create(C,k);if(M){if(y.push(M),t.parent)t.parent.addChild(M);try{M.render()}catch(D){var z=new Error('Render control "'+(M.id||"anonymous")+'" of type '+M.type+" failed because: "+D.message);throw z.actualError=D,z}}}}else;}return y};var h={};n.registerExtension=function(t){e(t,h)},n.createExtension=function(e,i){return t(e,i,h)};var d={};n.attachExtension=function(e,t){d[e]=t},n.createGlobalExtensions=function(){for(var e=d,t=[],i=0,a=e.length;a>i;i++){var o,r=e[i],s=r.type;if(s)o=n.create(s,r);o&&t.push(o)}return t};var m=[];return n.registerRule=function(e,t){m.push({type:e,priority:t}),m.sort(function(e,t){return e.priority-t.priority})},n.createRulesByControl=function(e){for(var t=[],i=0;i<m.length;i++){var n=m[i].type;if(null!=e.get(n.prototype.type))t.push(new n)}return t},n}),define("esui",["esui/main"],function(e){return e});