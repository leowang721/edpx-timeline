/*! @2014 Leo Wang. All Rights Reserved */
!function(e){function t(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}function i(){this.raw=[],this.length=0}function n(){return"___"+I++}function a(e,t){var i=new Function;i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function o(e){return K[e]}function r(e){return'"'+e.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function s(e){return e.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(e){return"\\"+e})}function l(e){var t=arguments;return e.replace(/\{([0-9]+)\}/g,function(e,i){return t[i-0+1]})}function h(e){return e=e.replace(/^\s*\*/,""),l('gv({0},["{1}"])',r(e),e.replace(/\[['"]?([^'"]+)['"]?\]/g,function(e,t){return"."+t}).split(".").join('","'))}function d(e,t,i,n,a,o){for(var r=i.length,s=e.split(t),l=0,h=[],d=0,m=s.length;m>d;d++){var p=s[d];if(d){var c=1;for(l++;;){var V=p.indexOf(i);if(0>V){h.push(l>1&&c?t:"",p);break}if(l=n?l-1:0,h.push(l>0&&c?t:"",p.slice(0,V),l>0?i:""),p=p.slice(V+r),c=0,0===l)break}if(0===l)a(h.join("")),o(p),h=[]}else p&&o(p)}if(l>0&&h.length>0)o(t),o(h.join(""))}function m(e,t,i){var n,a=[],o=t.options,s="",l="",p="",c="";if(i)s="ts(",l=")",p=S,c=E,n=o.defaultFilter;return d(e,o.variableOpen,o.variableClose,1,function(e){if(i&&e.indexOf("|")<0&&n)e+="|"+n;var o=e.indexOf("|"),r=(o>0?e.slice(0,o):e).replace(/^\s+/,"").replace(/\s+$/,""),d=o>0?e.slice(o+1):"",V=0===r.indexOf("*"),U=[V?"":s,h(r),V?"":l];if(d){d=m(d,t);for(var u=d.split("|"),f=0,y=u.length;y>f;f++){var g=u[f];if(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test(g)){if(U.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3)U.push(",",RegExp.$3);U.push(")")}}}a.push(p,U.join(""),c)},function(e){a.push(p,i?r(e):e,c)}),a.join("")}function p(e,t){this.value=e,this.engine=t}function c(e,t){this.value=e,this.engine=t,this.children=[],this.cloneProps=[]}function V(e,t){var i=e.stack,n=t?i.find(function(e){return e instanceof t}):i.bottom();if(n){for(var a;(a=i.top())!==n;){if(!a.autoClose)throw new Error(a.type+" must be closed manually: "+a.value);a.autoClose(e)}n.close(e)}return n}function U(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/_-]+)\s*\))?\s*/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.master=RegExp.$3,this.name=RegExp.$1,c.call(this,e,t),this.blocks={}}function u(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,c.call(this,e,t),this.cloneProps=["name"]}function f(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,c.call(this,e,t),this.cloneProps=["name","state","blocks"],this.blocks={}}function y(e,t){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.expr=RegExp.$2,c.call(this,e,t),this.cloneProps=["name","expr"]}function g(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,c.call(this,e,t),this.cloneProps=["name","args"]}function b(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,c.call(this,e,t),this.cloneProps=["name","args"]}function k(e,t){var i=new RegExp(l("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",s(t.options.variableOpen),s(t.options.variableClose)),"i");if(!i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,c.call(this,e,t),this.cloneProps=["list","item","index"]}function x(e,t){c.call(this,e,t)}function L(e,t){x.call(this,e,t)}function v(e,t){c.call(this,e,t)}function _(e,t){t.target=e;var i=t.engine,n=e.name;if(i.targets[n])switch(i.options.namingConflict){case"override":i.targets[n]=e,t.targets.push(n);case"ignore":break;default:throw new Error("Target exists: "+n)}else i.targets[n]=e,t.targets.push(n)}function W(e,t){O[e]=t,t.prototype.type=e}function w(e){this.options={commandOpen:"<!--",commandClose:"-->",commandSyntax:/^\s*(\/)?([a-z]+)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.config(e),this.targets={},this.filters=t({},C)}function X(e,t){function n(){var e;if(m.length>0&&(e=m.join(""))){var i=new p(e,t);if(i.beforeAdd(h),l.top().addChild(i),m=[],t.options.strip&&h.current instanceof c)i.value=e.replace(/^[\x20\t\r]*\n/,"");h.current=i}}var a,o=t.options.commandOpen,r=t.options.commandClose,s=t.options.commandSyntax,l=new i,h={engine:t,targets:[],stack:l,target:null},m=[];return d(e,o,r,0,function(e){var i=s.exec(e);if(i&&(a=O[i[2].toLowerCase()])&&"function"==typeof a){n();var l=h.current;if(t.options.strip&&l instanceof p)l.value=l.value.replace(/\r?\n[\x20\t]*$/,"\n");if(i[1])l=V(h,a);else{if(l=new a(i[3],t),"function"==typeof l.beforeOpen)l.beforeOpen(h);l.open(h)}h.current=l}else if(!/^\s*\/\//.test(e))m.push(o,e,r);a=null},function(e){m.push(e)}),n(),V(h),h.targets}i.prototype={push:function(e){this.raw[this.length++]=e},pop:function(){if(this.length>0){var e=this.raw[--this.length];return this.raw.length=this.length,e}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(e){for(var t=this.length;t--;){var i=this.raw[t];if(e(i))return i}}};var I=178245,K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},C={html:function(e){return e.replace(/[&<>"']/g,o)},url:encodeURIComponent,raw:function(e){return e}},J='var r="";',S="r+=",E=";",T="return r;";if("undefined"!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8)J="var r=[],ri=0;",S="r[ri++]=",T='return r.join("");';p.prototype={getRendererBody:function(){var e=this.value,t=this.engine.options;if(!e||t.strip&&/^\s*$/.test(e))return"";else return m(e,this.engine,1)},clone:function(){return this}},c.prototype={addChild:function(e){this.children.push(e)},open:function(e){var t=e.stack.top();t&&t.addChild(this),e.stack.push(this)},close:function(e){if(e.stack.top()===this)e.stack.pop()},getRendererBody:function(){for(var e=[],t=this.children,i=0;i<t.length;i++)e.push(t[i].getRendererBody());return e.join("")},clone:function(){for(var e=new this.constructor(this.value,this.engine),t=0,i=this.children.length;i>t;t++)e.addChild(this.children[t].clone());for(var t=0,i=this.cloneProps.length;i>t;t++){var n=this.cloneProps[t];e[n]=this[n]}return e}};var P='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';a(U,c),a(u,c),a(f,c),a(y,c),a(g,c),a(b,c),a(k,c),a(x,c),a(L,x),a(v,x);var A={READING:1,READED:2,APPLIED:3,READY:4};f.prototype.applyMaster=U.prototype.applyMaster=function(e){function t(e){var n=e.children;if(n instanceof Array)for(var a=0,o=n.length;o>a;a++){var r=n[a];if(r instanceof u&&i[r.name])r=n[a]=i[r.name];t(r)}}if(this.state>=A.APPLIED)return 1;var i=this.blocks,n=this.engine.targets[e];if(n&&n.applyMaster(n.master))return this.children=n.clone().children,t(this),this.state=A.APPLIED,1;else return void 0},U.prototype.isReady=function(){function e(n){for(var a=0,o=n.children.length;o>a;a++){var r=n.children[a];if(r instanceof f){var s=t.targets[r.name];i=i&&s&&s.isReady(t)}else if(r instanceof c)e(r)}}if(this.state>=A.READY)return 1;var t=this.engine,i=1;if(this.applyMaster(this.master))return e(this),i&&(this.state=A.READY),i;else return void 0},U.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var e=new Function("data","engine",[P,J,this.getRendererBody(),T].join("\n")),t=this.engine;return this.renderer=function(i){return e(i,t)},this.renderer}return null},U.prototype.open=function(e){V(e),c.prototype.open.call(this,e),this.state=A.READING,_(this,e)},y.prototype.open=b.prototype.open=function(e){e.stack.top().addChild(this)},u.prototype.open=function(e){c.prototype.open.call(this,e),(e.imp||e.target).blocks[this.name]=this},L.prototype.open=function(e){var t=new v;t.open(e);var i=V(e,x);i.addChild(this),e.stack.push(this)},v.prototype.open=function(e){var t=V(e,x);t.addChild(this),e.stack.push(this)},f.prototype.open=function(e){this.parent=e.stack.top(),this.target=e.target,c.prototype.open.call(this,e),this.state=A.READING,e.imp=this},b.prototype.close=y.prototype.close=function(){},f.prototype.close=function(e){c.prototype.close.call(this,e),this.state=A.READED,e.imp=null},U.prototype.close=function(e){c.prototype.close.call(this,e),this.state=this.master?A.READED:A.APPLIED,e.target=null},f.prototype.autoClose=function(e){var t=this.parent.children;t.push.apply(t,this.children),this.children.length=0;for(var i in this.blocks)this.target.blocks[i]=this.blocks[i];this.blocks={},this.close(e)},b.prototype.beforeOpen=f.prototype.beforeOpen=y.prototype.beforeOpen=k.prototype.beforeOpen=g.prototype.beforeOpen=u.prototype.beforeOpen=x.prototype.beforeOpen=p.prototype.beforeAdd=function(e){if(!e.stack.bottom()){var t=new U(n(),e.engine);t.open(e)}},f.prototype.getRendererBody=function(){return this.applyMaster(this.name),c.prototype.getRendererBody.call(this)},b.prototype.getRendererBody=function(){return l("{0}engine.render({2},{{3}}){1}",S,E,r(this.name),m(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(e,t,i){return(t||"")+r(i)+":"}))},y.prototype.getRendererBody=function(){if(this.expr)return l("v[{0}]={1};",r(this.name),m(this.expr,this.engine));else return""},x.prototype.getRendererBody=function(){return l("if({0}){{1}}",m(this.value,this.engine),c.prototype.getRendererBody.call(this))},v.prototype.getRendererBody=function(){return l("}else{{0}",c.prototype.getRendererBody.call(this))},k.prototype.getRendererBody=function(){return l('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',n(),m(this.list,this.engine),r(this.index||n()),r(this.item),n(),n(),c.prototype.getRendererBody.call(this))},g.prototype.getRendererBody=function(){var e=this.args;return l("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",J,T,S,E,c.prototype.getRendererBody.call(this),r(this.name),e?","+m(e,this.engine):"")};var O={};W("target",U),W("block",u),W("import",f),W("use",b),W("var",y),W("for",k),W("if",x),W("elif",L),W("else",v),W("filter",g),w.prototype.config=function(e){t(this.options,e)},w.prototype.compile=w.prototype.parse=function(e){if(e){var t=X(e,this);if(t.length)return this.targets[t[0]].getRenderer()}return new Function('return ""')},w.prototype.getRenderer=function(e){var t=this.targets[e];if(t)return t.getRenderer();else return void 0},w.prototype.render=function(e,t){var i=this.getRenderer(e);if(i)return i(t);else return""},w.prototype.addFilter=function(e,t){if("function"==typeof t)this.filters[e]=t};var M=new w;if(M.Engine=w,"object"==typeof exports&&"object"==typeof module)exports=module.exports=M;else if("function"==typeof define&&define.amd)define("etpl/main",[],M);else e.etpl=M}(this),define("etpl",["etpl/main"],function(e){return e});